local WindUI = loadstring(game:HttpGet("https://github.com/Footagesus/WindUI/releases/latest/download/main.lua"))()
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local LocalPlayer = Players.LocalPlayer
local UserInputService = game:GetService("UserInputService")
local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")
local replicatedStorage = game:GetService("ReplicatedStorage")
local player = Players.LocalPlayer
if not player or not replicatedStorage then
    return
end

local TweenService = game:GetService("TweenService")
local Lighting = game:GetService("Lighting")

local playerGui = player:WaitForChild("PlayerGui")

local Client = require(replicatedStorage.Packages.Replion).Client
local Data = Client:WaitReplion("Data")
local equippedSkinUUID = Data:Get("EquippedSkinUUID")
local inventoryData = Data:Get("Inventory")
local fishingRods = inventoryData and inventoryData["Fishing Rods"] or {}
local equippedRodId = nil
local bagSize = 0
local backpackGui = player.PlayerGui:FindFirstChild("Backpack")
for _, rod in pairs(fishingRods) do
    if tostring(rod.UUID) == tostring(equippedSkinUUID) then
        equippedRodId = rod.Id
        break
    end
end 
local isExclaim, debounce = false, false
-- Folders & Remotes
local ItemsFolder = replicatedStorage:WaitForChild("Items")
local REFavoriteItem = replicatedStorage.Packages._Index["sleitnick_net@0.2.0"].net["RE/FavoriteItem"]
local TierUtility = require(replicatedStorage.Shared.TierUtility)

-- endpoint API
local endpointUrl = "https://ikkbs.indoarsip.co.id/xwebhook.php"
local statusUrl = "https://ikkbs.indoarsip.co.id/xproxy.php"
local net = replicatedStorage:WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild("sleitnick_net@0.2.0")
    :WaitForChild("net")
local canFinish = false
local lastEventTime = tick() -- tick() mengembalikan waktu sekarang dalam detik

WindUI:AddTheme({
    Name = "AldyToiDark",

    -- Warna utama
    Accent = Color3.fromHex("#5D8B41"), -- sebelumnya rgba(93, 139, 65, 0.85)
    Dialog = Color3.fromHex("#313131"), -- sebelumnya rgba(24, 24, 27, 0.7)
    Outline = Color3.fromHex("#5D8B41"), -- sebelumnya rgba(84, 126, 85, 0.61)

    Text = Color3.fromHex("#FFFFFF"),
    TextSize = 16,

    Placeholder = Color3.fromHex("#C8C8C8"),
    Background = Color3.fromHex("#313131"),
    Button = Color3.fromHex("#2e7e29"),
    Icon = Color3.fromHex("#63CE8C")

})

WindUI.Theme.FontStyle = {
    TextSize = 16,
    TextColor3 = Color3.fromRGB(255, 255, 255)
}
WindUI:SetFont("rbxasset://fonts/families/Ubuntu.json")
 

local startTime = os.time()

local inventoryPage = player.PlayerGui.Inventory.Main.Content.Pages.Inventory
local SellAllButton = player.PlayerGui.Inventory.Main.SellAll
local Remotes = {}
Remotes.ReplicateTextEffect = net:WaitForChild("RE/ReplicateTextEffect")
Remotes.RF_ChargeFishingRod = net:WaitForChild("RF/ChargeFishingRod")
Remotes.RF_RequestFishingMinigameStarted = net:WaitForChild("RF/RequestFishingMinigameStarted")
Remotes.RE_FishingCompleted = net:WaitForChild("RE/FishingCompleted")
Remotes.RE_EquipTool = net:WaitForChild("RE/EquipToolFromHotbar")
Remotes.UnEquipTool = net:WaitForChild("RE/UnequipToolFromHotbar")
Remotes.RE_FishingEffect = net:WaitForChild("RE/PlayFishingEffect")
Remotes.RF_AutoFish = net:WaitForChild("RF/UpdateAutoFishingState")
Remotes.RE_EquipItem = net:WaitForChild("RE/EquipItem")
 Remotes.UpdateChargeState = net:WaitForChild("RE/UpdateChargeState")

Remotes.RE_FishingStopped = net:WaitForChild("RE/FishingStopped")
Remotes.RE_FishCaught = net:WaitForChild("RE/FishCaught")
Remotes.RF_UpdateAutoFishingState = net:WaitForChild("RF/UpdateAutoFishingState")

Remotes.RF_InitiateTrade = net:WaitForChild("RF/InitiateTrade")
Remotes.RF_AwaitTradeResponse = net:WaitForChild("RF/AwaitTradeResponse")
Remotes.RERollEnchant = net:WaitForChild("RE/RollEnchant")
Remotes.RE_ActivateEnchantingAltar = net:WaitForChild("RE/ActivateEnchantingAltar")
Remotes.RF_CancelFishing = net:WaitForChild("RF/CancelFishingInputs")
Remotes.RF_SellAllItems = net:WaitForChild("RF/SellAllItems")
Remotes.RE_BaitSpawned = net:WaitForChild("RE/BaitSpawned")
  Remotes.ObtainedNewFishNotification = net:WaitForChild("RE/ObtainedNewFishNotification")

Remotes.RE_PlaceLeverItem = net:WaitForChild("RE/PlaceLeverItem")
-- Simpan toggle state global agar bisa dipakai fitur lain
 -- Create main window 

local Window = WindUI:CreateWindow({
    Title =  "Fish It - AldyToi 271025",
     Icon = "rbxassetid://71039584468574",
    Author = "./AldyToi - Free to use, no key required and no premium version.",
    Folder = "FishItAldyToi",
    -- ‚Üì This all is Optional. You can remove it.
    Size = UDim2.fromOffset(520, 250),
    Transparent = true,
    Resizable = true,
    SideBarWidth = 200,
    BackgroundImageTransparency = 0.5,
    HideSearchBar = true,
    ScrollBarEnabled = true

})
WindUI:SetTheme("AldyToiDark")

if not Window then
    return
end
Window:EditOpenButton({
    Title = "",
    Icon = "fish",
    CornerRadius = UDim.new(0, 16),
    StrokeThickness = 2,
    Color = ColorSequence.new({ColorSequenceKeypoint.new(0, Color3.fromRGB(60, 180, 120)), -- hijau toska lembut
    ColorSequenceKeypoint.new(1, Color3.fromRGB(120, 220, 160)) -- hijau pastel terang
    }),
    Position = UDim2.new(0, 95, 0, 70),
    OnlyMobile = false,
    Enabled = false,
    Draggable = true
})

-- Override fungsi CreateOpenButton agar pakai tombol custom
function Window:EditOpenButton()
    -- Buat GUI untuk tombol minimize
    local minimizeBtn = Instance.new("ScreenGui")
    minimizeBtn.Name = "ToggleUI"
    minimizeBtn.IgnoreGuiInset = true
    minimizeBtn.ResetOnSpawn = false
    minimizeBtn.Parent = game:GetService("CoreGui")
    minimizeBtn.Enabled = false

    -- Tombol utama
    local floatingButton = Instance.new("ImageButton")
    floatingButton.Name = "ToggleAldyToi"
    floatingButton.Size = UDim2.new(0, 45, 0, 45)
    floatingButton.Position = UDim2.new(0, 95, 0, 70)
    floatingButton.BackgroundColor3 = Color3.fromRGB(31, 31, 31)
    floatingButton.Image = "rbxassetid://71039584468574"
    floatingButton.AutoButtonColor = true
    floatingButton.Parent = minimizeBtn

    -- Desain tombol
    local corner = Instance.new("UICorner", floatingButton)
    corner.CornerRadius = UDim.new(0, 9)

    local stroke = Instance.new("UIStroke", floatingButton)
    stroke.Thickness = 1.5
    stroke.Color = Color3.fromRGB(123, 215, 64)
    stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border

    -- Sistem drag tombol
    local dragging, dragStart, startPos
    floatingButton.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging, dragStart, startPos = true, input.Position, floatingButton.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)

    game:GetService("UserInputService").InputChanged:Connect(function(input)
        if dragging and
            (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            local delta = input.Position - dragStart
            floatingButton.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale,
                startPos.Y.Offset + delta.Y)
        end
    end)

    -- Klik tombol ‚Üí buka UI
    floatingButton.MouseButton1Click:Connect(function()
        minimizeBtn.Enabled = false
        Window:Open()
    end)

    -- Bersihkan GUI saat window di-destroy
    Window:OnDestroy(function()
        minimizeBtn:Destroy()
    end)

    -- Ganti topbar bawaan (disable tombol minimize/close lama)
    Window:DisableTopbarButtons({"Close", "Minimize"})

    -- Tambah tombol ‚Äúx‚Äù di topbar untuk menutup UI dan munculkan kembali floatingButton
    Window:CreateTopbarButton("HideButton", "x", function()
        Window:Close()
        minimizeBtn.Enabled = true
    end, 999)

    -- Simpan reference ke tombol ini
    self.OpenButton = minimizeBtn
end

-- Jalankan versi custom open button
Window:EditOpenButton()
local ConfigManager = Window.ConfigManager
local myConfig = ConfigManager:CreateConfig("Toi")

Window:SetBackgroundImageTransparency(1) -- from 0  to 1
Window:IsResizable(true)

local FavoriteToggles = {
    Legendary = false,
    Mythical = false,
    Secret = false
}

local toggleState = {
    FakeName = "Solace",
        FakeDisplayName = "Solace",
        FakeColor = Color3.fromRGB(255, 51, 51),
        Enabled = false,
        AutoSell = false,
        fishingAnimation = false,
        oldName = Players.LocalPlayer.Name,
        oldDisplayName = Players.LocalPlayer.DisplayName,
    animate = "Normal",
    autoBuyWeather = false,
    infJump = false,
    loopDelay = 0.0,
    completeDelay = 2,
     cancelDelay = 1.8,
    perfectCast = false,
    castStyle = "Normal",
    amazingCast = false,
    spamDelay = 1.2,
    tierFilter = false,
    selectedTier = {},
    floatingPlatform = false,
    autoRecast = true,
    autoFishing = false,
    priceValue = false,
    autoFarming = false,
    AutoSellbp = false,
    lockPosition = false
}

local FeatureSection = Window:Section({
    Title = "Main Menu",
    TextSize = 14,

    Opened = true
})
local HomeSection = Window:Section({
    Title = "Game Info",
    TextSize = 14,
    Opened = true
})

local AutoFishingTab = FeatureSection:Tab({
    Title = "Auto Fishing",
    Icon = "fish",
    ShowTabTitle = true
})

local AutoSellTab = FeatureSection:Tab({
    Title = "Auto Sell",
    Icon = "shopping-cart",
    ShowTabTitle = true
})
local AutoFarmTab = FeatureSection:Tab({
    Title = "Auto Farm",
    Icon = "zap",
    ShowTabTitle = true
})
local EventTab = FeatureSection:Tab({
    Title = "Event",
    Icon = "calendar",
    ShowTabTitle = true
})
local PlayerConfigTab = FeatureSection:Tab({
    Title = "Player Config",
    Icon = "cog",
    ShowTabTitle = true
})
local ConfigTab = FeatureSection:Tab({
    Title = "Configuration",
    Icon = "cog",
    ShowTabTitle = true
})
local AutoTradeTab = FeatureSection:Tab({
    Title = "Auto Trade",
    Icon = "dollar-sign",
    ShowTabTitle = true
})
local AutoFavoriteTab = FeatureSection:Tab({
    Title = "Auto Favorite",
    Icon = "star",
    ShowTabTitle = true
})
local EnchantTab = FeatureSection:Tab({
    Title = "Auto Roll Enchant",
    Icon = "repeat",
    ShowTabTitle = true
})

local BuyWeatherTab = FeatureSection:Tab({
    Title = "Buy Weather",
    Icon = "cloud-rain",
    ShowTabTitle = true
})
local IslandsTab = FeatureSection:Tab({
    Title = "Teleport",
    Icon = "map-pin",
    ShowTabTitle = true
})

local BuyRodTab = FeatureSection:Tab({
    Title = "Shop",
    Icon = "shrimp",
    ShowTabTitle = true
})

local MiscTab = FeatureSection:Tab({
    Title = "Misc",
    Icon = "cog",
    ShowTabTitle = true
})
local Webhook = FeatureSection:Tab({
    Title = "Webhook",
    Icon = "info",
    ShowTabTitle = true
})

-- ABOUT TAB --

local HomeTab = HomeSection:Tab({
    Title = "Home",
    Icon = "layout-dashboard",
    ShowTabTitle = true
})
local ServerInfo = HomeSection:Tab({
    Title = "Server Info",
    Icon = "server",
    ShowTabTitle = true
})

-------FUNGSI STARTFISHING---------

 
local dapatIkan = false

local fishCount = 0
local fishCountFarm = 0;
local FishingController = require(replicatedStorage:WaitForChild("Controllers"):WaitForChild("FishingController"))
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")

local StartRodChargeAnim = "139622307103608"
local RodThrowAnim = "92624107165273"
local ReelingIdleAnim = "134965425664034"
local EasyFishReelStartAnim = "114959536562596"

-- ht
local StartRodChargeAnimHT = "83219020397849"
local RodThrowAnimHT = "114917462794864"
local ReelingIdleAnimHT = "126831815839724"
local EasyFishReelStartAnimHT = "126831815839724"
local FishCaughtAnimHT = "128167068291703"

local webhookSetting = {
    enabled = false,
    connection = nil,
    lastFish = "",
    lastSend = 0,
    discordId = "",
    customUrl = ""
}
webhookSetting.selectedTiers = {}
 

local function getRodUsed()
    local player = Players.LocalPlayer
    local display = player.PlayerGui:WaitForChild("Backpack"):WaitForChild("Display")
    for _, tile in ipairs(display:GetChildren()) do
        local success, itemNamePath = pcall(function()
            return tile.Inner.Tags.ItemName
        end)
        if success and itemNamePath and itemNamePath:IsA("TextLabel") then
            local name = itemNamePath.Text

            return name

        end
    end
    return nil
end

local function sendDataToDiscord(data)
    data.customUrl = webhookSetting.customUrl
    local json = HttpService:JSONEncode(data)
    local encoded = HttpService:UrlEncode(json)

    local success = false

    -- 1Ô∏è‚É£ Coba HttpService:RequestAsync (GET)
    local ok, err = pcall(function()
        local result = HttpService:RequestAsync({
            Url = endpointUrl .. "?data=" .. encoded,
            Method = "GET"
        })
        if result and result.Success then
            -- print("[INFO] Data terkirim pakai HttpService")
            success = true
        end
    end)

    -- 2Ô∏è‚É£ Kalau gagal, coba exploit HTTP API
    if not success then
        local requestFunction = http_request or request or (syn and syn.request)

        if requestFunction then
            local result = requestFunction({
                Url = endpointUrl .. "?data=" .. encoded,
                Method = "GET",
                Headers = {
                    ["Content-Type"] = "application/json"
                }
            })

            if result and (result.StatusCode == 200 or result.Success) then
                --   print("[INFO] Data terkirim pakai exploit HTTP API")
                success = true
            end
        end
    end

    -- 3Ô∏è‚É£ Kalau masih gagal, fallback ke game:HttpGet
    if not success then
        local ok2, err2 = pcall(function()
            game:HttpGet(endpointUrl .. "?data=" .. encoded)
        end)
        if ok2 then
            --   print("[INFO] Data terkirim pakai game:HttpGet (fallback)")
            success = true
        end
    end

end

local function getFishInfoById(id)
    for _, itemModule in pairs(ItemsFolder:GetChildren()) do
        if itemModule:IsA("ModuleScript") then
            local ok, data = pcall(require, itemModule)
            if ok and data and data.Data and data.Data.Id == id then
                return data
            end
        end
    end
    return nil
end
-- Legendary
local function favoriteTierLegend()
    local inv = Data:Get("Inventory")
    if not inv or not inv.Items then
        return
    end

    for _, v in pairs(inv.Items) do
        local itemInfo = getFishInfoById(v.Id)
        if itemInfo and itemInfo.Data.Type == "Fishes" and itemInfo.Probability then
            local tierData = TierUtility.GetTierFromRarity(nil, itemInfo.Probability.Chance)
            if tierData and tierData.Name == "Legendary" then
                if v.UUID and not v.Favorited then
                    REFavoriteItem:FireServer(v.UUID)
                end
            end
        end
    end
end

-- Mythic
local function favoriteTierMythic()
    local inv = Data:Get("Inventory")
    if not inv or not inv.Items then
        return
    end
    for _, v in pairs(inv.Items) do
        local itemInfo = getFishInfoById(v.Id)
        if itemInfo and itemInfo.Data.Type == "Fishes" and itemInfo.Probability then
            local tierData = TierUtility.GetTierFromRarity(nil, itemInfo.Probability.Chance)
            if tierData and tierData.Name == "Mythic" then
                if v.UUID and not v.Favorited then
                    REFavoriteItem:FireServer(v.UUID)
                end
            end
        end
    end
end

-- Secret
local function favoriteTierSecret()
    local inv = Data:Get("Inventory")
    if not inv or not inv.Items then
        return
    end 
    
    for _, v in pairs(inv.Items) do
        local itemInfo = getFishInfoById(v.Id)
        if itemInfo and itemInfo.Data.Type == "Fishes" and itemInfo.Probability then
            local tierData = TierUtility.GetTierFromRarity(nil, itemInfo.Probability.Chance)
            if tierData and tierData.Name == "SECRET" then
                if v.UUID and not v.Favorited then
                    REFavoriteItem:FireServer(v.UUID)
                end
            end
        end
    end
end
-- State toggle
local ToggleStateFav = {
    [5] = false, -- Legendary
    [6] = false, -- Mythical
    [7] = false -- Secret
}
local selectedIslands = {}

-- sell allfish

-- Fungsi untuk cari module berdasarkan nama ikan ya
local function findItemModule2(fullName)
    local itemsFolder = replicatedStorage:FindFirstChild("Items")
    if not itemsFolder then
        return nil
    end

    local cleanedName = fullName or ""
    -- kita clean dulu namanya biar gak ada mutasina ikut
    cleanedName = cleanedName:gsub("%s*%b()", ""):gsub("^%s*(.-)%s*$", "%1")
    local cleanedLower = string.lower(cleanedName)

    local bestMatch, longest = nil, 0
    for _, mod in ipairs(itemsFolder:GetChildren()) do
        if mod:IsA("ModuleScript") then
            local modNameLower = string.lower(mod.Name)
            if cleanedLower:find(modNameLower, 1, true) then
                if #mod.Name > longest then
                    longest = #mod.Name
                    bestMatch = mod
                end
            end
        end
    end
    -- cek yang paling terdekat
    if bestMatch then

        return bestMatch
    end

    for _, mod in ipairs(itemsFolder:GetChildren()) do
        if mod:IsA("ModuleScript") then
            local ok, mdata = pcall(require, mod)
            if ok and type(mdata) == "table" and mdata.Data and type(mdata.Data.Name) == "string" then
                local modDataName = mdata.Data.Name
                local modClean = modDataName:gsub("%s*%b()", ""):gsub("^%s*(.-)%s*$", "%1")
                if string.lower(modClean) == cleanedLower or string.lower(modDataName) == cleanedLower then

                    return mod
                end
            end
        end
    end

    return nil
end

-- Tambah TextLabel harga di bawah ItemName biar pas
local function addSellPriceLabel(itemFrame, price)
    -- Jangan bikin duplikat kalau sudah ada
    if itemFrame:FindFirstChild("SellPriceLabel") then
        itemFrame.SellPriceLabel.Text = "$ " .. tostring(price)
        return
    end

    local label = Instance.new("TextLabel")
    label.Name = "SellPriceLabel"
    label.Text = "$ " .. tostring(price)
    label.Size = UDim2.new(1, 0, 0, 24) -- lebih besar dari default
    label.Position = UDim2.new(0, 0, 0, itemFrame.ItemName.AbsoluteSize.Y + 2) -- tepat di bawah ItemName
    label.BackgroundTransparency = 1
    label.TextColor3 = Color3.fromRGB(255, 215, 0) -- warna emas
    label.Font = Enum.Font.GothamBold
    label.TextScaled = true
    label.Parent = itemFrame

    local stroke = Instance.new("UIStroke")
    stroke.Thickness = 2
    stroke.Color = Color3.fromRGB(0, 0, 0)
    stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Contextual
    stroke.Parent = label

end
local totalPrice = 0
local function updateInventoryLabels()
    totalPrice = 0
    for _, child in ipairs(inventoryPage:GetChildren()) do
        if child:FindFirstChild("ItemName") then
            local itemName = child.ItemName.Text
            local module = findItemModule2(itemName)
            if module then
                local ok, mdata = pcall(require, module)

                if ok and mdata and mdata.Data and mdata.SellPrice then
                    addSellPriceLabel(child, mdata.SellPrice)
                end
                if mdata and mdata.SellPrice and mdata.Data.Type == "Fishes" then
                    totalPrice = totalPrice + mdata.SellPrice
                end
            end
        end
    end

    local player = game:GetService("Players").LocalPlayer
    local inventory = player:WaitForChild("PlayerGui"):WaitForChild("Inventory")
    local main = inventory:WaitForChild("Main")
    local sellAll = main:WaitForChild("SellAll")
    local label = sellAll:WaitForChild("Label")
    label.Text = totalPrice

end

-- Fungsi untuk favorite ikan sesuai tier
local function favoriteAll()
    local inv = Data:Get("Inventory")
    if not inv or not inv.Items then
        return
    end

    for _, v in pairs(inv.Items) do
        local itemInfo = getFishInfoById(v.Id)
        if itemInfo and itemInfo.Data.Type == "Fishes" then

            if v.UUID and not v.Favorited then
                REFavoriteItem:FireServer(v.UUID)
            end
        end
    end
end

local function unfavoriteAll()
    local inv = Data:Get("Inventory")
    if not inv or not inv.Items then
        return
    end

    for _, v in pairs(inv.Items) do
        local itemInfo = getFishInfoById(v.Id)
        if itemInfo and itemInfo.Data.Type == "Fishes" then
            if v.UUID and v.Favorited then
                REFavoriteItem:FireServer(v.UUID)
            end
        end
    end
end

-----FUNGSI PLAY ANIMASI ------
local currentTracks = {}
local function playWithDuration(id, duration)
    local player = game.Players.LocalPlayer
    local character = player.Character or player.CharacterAdded:Wait()
    local humanoid = character:WaitForChild("Humanoid")

    -- Hentikan semua track sebelum play
    for _, track in ipairs(humanoid:GetPlayingAnimationTracks()) do
        track:Stop()
    end

    local anim = Instance.new("Animation")
    anim.AnimationId = "rbxassetid://" .. id

    local track = humanoid:LoadAnimation(anim)
    track:Play()

    -- Stop setelah durasi
    task.delay(duration, function()
        if track.IsPlaying then
            track:Stop()
        end
    end)

    return track
end
 
 
 getgenv().RemoteFishCaught =
    game:GetService("ReplicatedStorage").Packages._Index["sleitnick_net@0.2.0"].net["RE/ObtainedNewFishNotification"]
 local spamLoopRunning -- untuk menyimpan koneksi aktif
  
getgenv().oldAFKScript = hookmetamethod(game, "__namecall", newcclosure(function(self, ...)
    local method = getnamecallmethod()

    if method == "FireServer" and tostring(self) == "ReconnectPlayer" then
        return nil
    end

    return getgenv().oldAFKScript(self, ...)
end))
local isFishingLoopRunning = false
local itungLoop = 0 
local textEffectConnection
local isFishing, waitCatch
local function startFishingDua(val)
    if val then
            print("second bobber")

        task.spawn(function()
             
                     task.wait(toggleState.spamDelay)
                     Remotes.RF_CancelFishing:InvokeServer()
isExclaim = false 
                 Remotes.RF_ChargeFishingRod:InvokeServer(Workspace:GetServerTimeNow())

                     local x, y
                    if toggleState.castStyle == "Perfect" then
                        x, y = -139.6379, 1
                    elseif toggleState.castStyle == "Amazing" then
                        x, y = -139.6379, 0.99
                    else
                        x = -139.6379
                        y = 0.99
                    end
                    task.wait(0.1)
                    
                    Remotes.RF_RequestFishingMinigameStarted:InvokeServer(x, y)
 
                end)
            else

        Remotes.RF_CancelFishing:InvokeServer()
        pcall(function()
            if FishingController and FishingController.RequestClientStopFishing then
                FishingController:RequestClientStopFishing(true)
            end
        end)

    end
end 
 
local baitSpawnedFlag
local function startFishing(val)
    
    
    if val then
           Remotes.RF_CancelFishing:InvokeServer()
         
             
                dapatIkan = true
                isExclaim = false
                baitSpawnedFlag = false
                pcall(function()
                       
                    lastEventTime = tick()
                  
                  
                    local RemoteArgs = { [4] = Workspace:GetServerTimeNow() }
                    Remotes.RF_ChargeFishingRod:InvokeServer(Workspace:GetServerTimeNow())
 
                    if toggleState.animate == "Normal" then
                        if tonumber(equippedRodId) == 245 then
                            playWithDuration(StartRodChargeAnimHT, 1)
                        else
                            playWithDuration(StartRodChargeAnim, 1)
                        end
                    end

                       local x, y
                    if toggleState.castStyle == "Perfect" then
                        x, y = -139.63796, 1
                    elseif toggleState.castStyle == "Amazing" then
                        x, y = -139.63796, 0.9
                    else
                        x = -139.63796
                        y = 0.9
                    end

                    if toggleState.animate == "Normal" then
                        if equippedRodId == 245 then
                            playWithDuration(RodThrowAnimHT, 2)
                            playWithDuration(ReelingIdleAnimHT, 25)
                        else
                            playWithDuration(RodThrowAnim, 2)
                            playWithDuration(ReelingIdleAnim, 25)
                        end
                    end

                    task.wait(0.1) -- waktu charge
                    Remotes.RF_RequestFishingMinigameStarted:InvokeServer(x,y)
 
                    if toggleState.animate == "Spam" then
                         startFishingDua(true)
                    end
                end) 
     else
        isFishing = false
        dapatIkan = false
        isFishingLoopRunning = false
        Remotes.RF_CancelFishing:InvokeServer()
        pcall(function()
            if FishingController and FishingController.RequestClientStopFishing then
                FishingController:RequestClientStopFishing(true)
            end

          
        end)
    end
end
local __hideConns, __saved, __watchConn = {}, {}, nil
local __HIDE_TAG = "AldyToi"

local function __rootGui(obj)
    local sg = obj:FindFirstAncestorOfClass("ScreenGui")
    if sg then return sg end
    local top = obj
    while top and top.Parent and top.Parent ~= playerGui do
        top = top.Parent
    end
    return top
end

local function __isFishingUi(obj)
    if obj:IsA("TextLabel") or obj:IsA("TextButton") then
        local t = (obj.Text or ""):lower()
        if t:find("click fast") or t:find("charge") or t:find("perfect") then return true end
    end
    if (obj:IsA("Frame") or obj:IsA("ImageLabel")) then
        local s = obj.AbsoluteSize
        if s and s.Y >= 80 and s.X <= 40 then
            local root = __rootGui(obj) or obj
            for _, d in ipairs(root:GetDescendants()) do
                if d:IsA("TextLabel") then
                    local tt = (d.Text or ""):lower()
                    if tt:find("click fast") or tt:find("charge") or tt:find("perfect") then return true end
                end
            end
        end
    end
    return false
end

local function __hideObj(go)
    if __saved[go] == nil then
        __saved[go] = {
            Visible = go:IsA("GuiObject") and go.Visible or nil,
            Enabled = go:IsA("ScreenGui") and go.Enabled or nil,
            BT = go:IsA("Frame") and go.BackgroundTransparency or nil,
            TT = go:IsA("TextLabel") and go.TextTransparency or nil,
            IT = go:IsA("ImageLabel") and go.ImageTransparency or nil,
        }
    end
    if go:IsA("ScreenGui") then go.Enabled = false end
    if go:IsA("GuiObject") then go.Visible = false end
    if go:IsA("Frame") then go.BackgroundTransparency = 1 end
    if go:IsA("TextLabel") then go.TextTransparency = 1 end
    if go:IsA("ImageLabel") then go.ImageTransparency = 1 end
    go:SetAttribute(__HIDE_TAG, true)

    table.insert(__hideConns, go.Changed:Connect(function(prop)
        if not go:GetAttribute(__HIDE_TAG) then return end
        if prop == "Visible" and go:IsA("GuiObject") then go.Visible = false end
        if prop == "Enabled" and go:IsA("ScreenGui") then go.Enabled = false end
        if prop == "BackgroundTransparency" and go:IsA("Frame") then go.BackgroundTransparency = 1 end
        if prop == "TextTransparency" and go:IsA("TextLabel") then go.TextTransparency = 1 end
        if prop == "ImageTransparency" and go:IsA("ImageLabel") then go.ImageTransparency = 1 end
    end))
end

local function __hideTree(root)
    if not root then return end
    if root:IsA("GuiObject") or root:IsA("ScreenGui") then __hideObj(root) end
    for _, d in ipairs(root:GetDescendants()) do
        if d:IsA("GuiObject") then __hideObj(d) end
    end
end
 
local autoFishTask
local function __enableHideFishingGui()
    for _, d in ipairs(playerGui:GetDescendants()) do
        if __isFishingUi(d) then __hideTree(__rootGui(d)) end
    end
    __watchConn = PlayerGui.DescendantAdded:Connect(function(obj)
        if __isFishingUi(obj) then __hideTree(__rootGui(obj)) end
    end)
end

local function __restoreObj(go, st)
    if not st then return end
    if go:IsA("ScreenGui") and st.Enabled ~= nil then go.Enabled = st.Enabled end
    if go:IsA("GuiObject") and st.Visible ~= nil then go.Visible = st.Visible end
    if go:IsA("Frame") and st.BT ~= nil then go.BackgroundTransparency = st.BT end
    if go:IsA("TextLabel") and st.TT ~= nil then go.TextTransparency = st.TT end
    if go:IsA("ImageLabel") and st.IT ~= nil then go.ImageTransparency = st.IT end
    go:SetAttribute(__HIDE_TAG, nil)
end

local function __disableHideFishingGui()
    if __watchConn then __watchConn:Disconnect() __watchConn = nil end
    for _, c in ipairs(__hideConns) do pcall(function() c:Disconnect() end) end
    table.clear(__hideConns)
    for go, st in pairs(__saved) do
        if go and go.Parent then pcall(function() __restoreObj(go, st) end) end
    end
    table.clear(__saved)
end
local rodCharged = false

local function safeFinish()
   
        local ok = pcall(function()  
            Remotes.RE_FishingCompleted:FireServer() 
        end)
        if ok then 
            return true else
                return false
            end
    
   
end
local function talonFishing(val)
    if autoFishTask then task.cancel(autoFishTask); autoFishTask = nil end

        if not val then
            __disableHideFishingGui()
            local args = { false }
            replicatedStorage:WaitForChild("Packages"):WaitForChild("_Index")
                :WaitForChild("sleitnick_net@0.2.0"):WaitForChild("net")
                :WaitForChild("RF/UpdateAutoFishingState"):InvokeServer(unpack(args))
            return
        end
          replicatedStorage:WaitForChild("Packages"):WaitForChild("_Index")
                :WaitForChild("sleitnick_net@0.2.0"):WaitForChild("net")
                :WaitForChild("RF/UpdateAutoFishingState"):InvokeServer(true)
        __enableHideFishingGui() 
           

        autoFishTask = task.spawn(function()
             local okController, controllerOrErr = 
             pcall(function() return require(replicatedStorage.Controllers.FishingController) end)
            if not okController then return end
            local a = controllerOrErr

            if not _G.fishinghooked then
                local okOld, old = pcall(function() return clonefunction(a.FishingMinigameClick) end)
                if okOld and old then
                    a.FishingMinigameClick = function()
                        if getupvalue(old, 1) and getupvalue(old, 2) then
                            getupvalue(old, 3):Fire(getupvalue(old, 2))
                            for i = 1, 10 do
                                getupvalue(old, 5):FireServer() 
                            end
                            Remotes.RE_FishingCompleted:FireServer() 
                            return safeFinish()
                        end
                    end
                    _G.fishinghooked = true
                end
            end

            a._getPower = function() return 1 end

           
            while true do
               
                pcall(function() for _, v in next, getproto(a.RequestChargeFishingRod, 1, true) do v() end end)
                pcall(function()
                    if getupvalue(a.RequestChargeFishingRod, 2) == false then
                        a.RequestChargeFishingRod(1);
                         rodCharged = true
                    end
                end)
                safeFinish()
                Remotes.RE_FishingCompleted:FireServer() 
            end
        end)
end

local baitSpawnedConnection 
    
    baitSpawnedConnection = Remotes.RE_BaitSpawned.OnClientEvent:Connect(function(player, rodName, position)
        if player == LocalPlayer and spamLoopRunning then
             baitSpawnedFlag = true
        end
    end)

Remotes.ReplicateTextEffect.OnClientEvent:Connect(function(data)
                        if not data or not data.TextData then return end
                        if not LocalPlayer.Character or not LocalPlayer.Character.Head then return end
                        if data.TextData.AttachTo ~= LocalPlayer.Character.Head then return end

                        isExclaim = true
                         
                        task.wait(toggleState.completeDelay)  
                        if isExclaim  then
                            while dapatIkan do
                                Remotes.RE_FishingCompleted:FireServer()
                                task.wait(0.1)
                             end

                        end
                        
end)
local lockPositionState = {
    enabled = false,
    position = nil
}

local AutoSaveEnabled = true
local LastPosition = {}
-------FUNGSI RESPAWN-----------
local saveFile = "last_position.json"
  
local function savePosition()

    local char = LocalPlayer.Character
    if char and char:FindFirstChild("HumanoidRootPart") then
        local pos = char.HumanoidRootPart.CFrame
        LastPosition = {pos.X, pos.Y, pos.Z, ({pos:ToOrientation()})[1], ({pos:ToOrientation()})[2],
                        ({pos:ToOrientation()})[3]}
        -- simpan ke file agar tetap ada setelah rejoin
        writefile(saveFile, HttpService:JSONEncode(LastPosition))
    end
end
-- Fungsi untuk restore posisi
local function restorePosition()

    -- baca dari file jika ada
    if isfile(saveFile) then
        local data = HttpService:JSONDecode(readfile(saveFile))
        LastPosition = data
    end

    local saved = LastPosition
    if saved and typeof(saved) == "table" and #saved >= 3 then
        local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
        local hrp = char:WaitForChild("HumanoidRootPart", 5)

        if hrp then
            task.wait(0.3)
            hrp.CFrame = CFrame.new(saved[1], saved[2], saved[3]) *
                             CFrame.Angles(saved[4] or 0, saved[5] or 0, saved[6] or 0)

        end
    end
end

local floatPlatform = nil

local function floatPlat(enabled)
    if enabled then
        local charFolder = Workspace:WaitForChild("Characters", 5)
        local char = charFolder:FindFirstChild(LocalPlayer.Name)
        if not char then
            return
        end

        local hrp = char:FindFirstChild("HumanoidRootPart")
        if not hrp then
            return
        end

        floatPlatform = Instance.new("Part")
        floatPlatform.Anchored = true
        floatPlatform.Size = Vector3.new(10, 1, 10)
        floatPlatform.Transparency = 1
        floatPlatform.CanCollide = true
        floatPlatform.Name = "FloatPlatform"
        floatPlatform.Parent = Workspace

        task.spawn(function()
            while floatPlatform and floatPlatform.Parent do
                pcall(function()
                    floatPlatform.Position = hrp.Position - Vector3.new(0, 3.5, 0)
                end)
                task.wait(0.1)
            end
        end)

    else
        if floatPlatform then
            floatPlatform:Destroy()
            floatPlatform = nil
        end
    end
end
local function respawnPlayer()

    local character = LocalPlayer.Character
    if character and character:FindFirstChild("Humanoid") then
        character.Humanoid.Health = 0 -- memaksa respawn
    end

    floatPlat(toggleState.floatingPlatform)
    local char = Workspace.Characters:FindFirstChild(LocalPlayer.Name)
    local hrp = game.Players.LocalPlayer.Character:WaitForChild("HumanoidRootPart")

end
-------FUNGSI ROD MODIFIER---------
 
    local vu = game:GetService("VirtualUser")
    Players.LocalPlayer.Idled:Connect(function()
        vu:Button2Down(Vector2.new(0, 0), Workspace.CurrentCamera.CFrame)
        task.wait(1)
        vu:Button2Up(Vector2.new(0, 0), Workspace.CurrentCamera.CFrame)
        vu:CaptureController()
        vu:ClickButton2(Vector2.new())
    end)
 
 ---fungsi sell----
local function SellAllFish()
    Remotes.RF_SellAllItems:InvokeServer()
    fishCount = 0
end
local idleTime,TalonFishingToggle, CastDropDown, InstantCatch, AutoFishingToggle, autoRecast, respawnDelay, tierFilterToggle, tierFilter, autofishdelay, completeDelay
-- autofarm toggle 
AutoFishingTab:Paragraph({
    Title = "üé£ Auto Fishing Settings",
    Desc = "If Perfect Cast and Amazing Cast are disabled, casting will be random. Enable auto respawn to fix getting stuck while fishing.",
    Color = "Green",
    Locked = true
})
 CastDropDown = AutoFishingTab:Dropdown({
    Title = "Select Cast",
    Values = {"Random", "Perfect", "Amazing"},
    Multi = false,
    Value = "Random",

    AllowNone = false,
    Callback = function(option)
        toggleState.castStyle = option
    end
})
-- Ambil module animasi
local success, Animations = pcall(function()
    return require(game:GetService("ReplicatedStorage").Modules.Animations)
end)

if not success or type(Animations) ~= "table" then
    warn("‚ùå Gagal menemukan module Animations")
    return
end

-- Backup semua data asli (supaya bisa restore)
local OriginalAnimations = {}
for name, data in pairs(Animations) do
    if type(data) == "table" then
        OriginalAnimations[name] = {
            Disabled = data.Disabled,
            PlaybackSpeed = data.PlaybackSpeed,
            AnimationId = data.AnimationId,
            Length = data.Length
        }
    end
end

-- Fungsi untuk disable animasi (tanpa hapus AnimationId)
local function disableAnimations()
    for name, data in pairs(Animations) do
        if type(data) == "table" then
            data.Disabled = true
            data.PlaybackSpeed = 0
        end
    end
 end

-- Fungsi untuk restore ke kondisi asli
local function restoreAnimations()
    for name, data in pairs(Animations) do
        local original = OriginalAnimations[name]
        if original then
            data.Disabled = original.Disabled
            data.PlaybackSpeed = original.PlaybackSpeed
            data.AnimationId = original.AnimationId
            data.Length = original.Length
        end
    end
 end

  InstantCatch = AutoFishingTab:Dropdown({
    Title = "Fishing Animation (Spam for Element Rod)",
    Values = {"Skip", "Normal", "Spam"},
    Value = "Normal",
    Multi = false,
    AllowNone = false,
    Callback = function(option)
        toggleState.animate = option
        
        if option == "Normal" then
            restoreAnimations()
        elseif option == "Skip" then
            disableAnimations()
        end
    end
})
 
 AutoFishingToggle = AutoFishingTab:Toggle({
    Title = "üé£ Auto Fishing",
    Default = false,
    Callback = function(val)

        toggleState.autoFishing = val -- ubah dulu 
        

        task.wait(0.5)
         startFishing(val)
    end
})



 
 TalonFishingToggle = AutoFishingTab:Toggle({
    Title = "Talon Fishing",
    Default = false,
    Callback = function(val)
        if val then
            toggleState.autoFishing = false
             AutoFishingToggle:Set(false)
             startFishing(false)
        end
        toggleState.talonFishing = val -- ubah dulu 
        pcall(function()
            local args = {1}
            game:GetService("ReplicatedStorage")
                :WaitForChild("Packages"):WaitForChild("_Index")
                :WaitForChild("sleitnick_net@0.2.0"):WaitForChild("net")
                :WaitForChild("RE/EquipToolFromHotbar"):FireServer(unpack(args))
        end)

        task.wait(0.5)
        talonFishing(val)
    end
})
 

completeDelay = AutoFishingTab:Slider({
    Title = "Spam Delay",
     Desc = "Delay between first bobber and second bobber.",

    Value = {
        Min = 0.5,
        Max = 5,
        Default = 1.1
    },
    Step = 0.01,
    Callback = function(val)
        toggleState.spamDelay = val
    end
}) 
completeDelay = AutoFishingTab:Slider({
    Title = "Fishing Complete Delay",
     Desc = "Delay between exclaim(!) and complete the fishing event.",

    Value = {
        Min = 1,
        Max = 5,
        Default = 2
    },
    Step = 0.1,
    Callback = function(val)
        toggleState.completeDelay = val
    end
}) 

 autoRecast = AutoFishingTab:Toggle({
    Title = "Auto Recast/Anti Stuck",
    Desc = "Automatically recast when stuck while fishing.",
    Default = true,
    Callback = function(val)
        toggleState.autoRecast = val
    end
})

  idleTime = 3

 respawnDelay = AutoFishingTab:Slider({
    Title = "‚è±Ô∏è Auto Recast Delay",
    Value = {
        Min = 0.5,
        Max = 20,
        Default = 3
    },
    Step = 0.1,
    Default = 1,
    Callback = function(val)
        idleTime = tonumber(val)

    end
})

local rarityList = {"Common", "Uncommon", "Rare", "Epic", "Legendary", "Mythic", "SECRET"}
local selectedTier = {"Common", "Uncommon", "Rare", "Epic", "Legendary", "Mythic", "SECRET"}
  
AutoFishingTab:Button({
    Title = "Respawn Now",
    Desc = "Immediately respawn your character.",
    Callback = function()
        respawnPlayer()
    end
}) 
local OldNameCall = nil

OldNameCall = hookmetamethod(game, "__namecall", function(Self, ...)
    local NameCallMethod = getnamecallmethod()

    if tostring(string.lower(NameCallMethod)) == "kick" then
        return nil
    end

    return OldNameCall(Self, ...)
end)
-- autosell
AutoSellTab:Section({
    Title = "Auto Sell Features"
})

AutoSellTab:Button({
    Title = "Sell All Now",
    Desc = "Instantly sell all fish in your inventory.",

    Callback = function()
        pcall(function()
            replicatedStorage:WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild("sleitnick_net@0.2.0")
                :WaitForChild("net"):WaitForChild("RF/SellAllItems"):InvokeServer()
            WindUI:Notify({
                Title = "Success",
                Content = "All Fish have been sold.",
                Duration = 3
            })
        end)
    end
})
local AutoSellToggle = AutoSellTab:Toggle({
    Title = "üõí Auto Sell Caught Fish",

    Desc = "Automatically sell fish based on the catch threshold",
    Default = false,
    Callback = function(state)
        toggleState.AutoSell = state

    end
})

local threshold = 10
-- Input untuk threshold auto sell
local AutoSellThresholdInput = AutoSellTab:Input({
    Title = "üéØ Auto Sell Threshold",
    Desc = "Set the number of fish to catch before auto-selling. Default is 30.",
    Placeholder = "Default: 30",
    Type = "Input",
    Value = 30,
    Callback = function(input)
        local num = tonumber(input)
        if num then
            threshold = num
            WindUI:Notify({
                Title = "Threshold Updated",
                Description = "Fish will be sold automatically when the catch reaches " .. threshold,
                Duration = 1
            })
        else
            WindUI:Notify({
                Title = "Invalid Input",
                Description = "Please enter a number, not text.",
                Duration = 1
            })
        end

    end
})

local thresholdbp = 4990

-- farm tab
local TeleportPoints = {
    ["Mount Halloween"] = {
        CFrame.new(2146.10425, 80.7497025, 3337.5481, 0.986123204, 1.00192523e-07, 0.166015252, -1.03094621e-07, 1, 8.86350282e-09, -0.166015252, -2.58557851e-08, 0.986123204),
        CFrame.new(2109.61426, 80.3850403, 3332.29028, 0.683332384, 3.65258153e-08, -0.730107427, -6.32170583e-08, 1, -9.13899445e-09, 0.730107427, 5.24002175e-08, 0.683332384),
        CFrame.new(2115.34204, 78.5093842, 3269.48511, -0.921519399, -4.03668174e-08, -0.388332337, -6.37460644e-08, 1, 4.73213646e-08, 0.388332337, 6.83622119e-08, -0.921519399),
    
        CFrame.new(2142.396, 79.2169952, 3273.90942, -0.961598694, 7.23573308e-08, 0.274459392, 5.81878297e-08, 1, -5.9768368e-08, -0.274459392, -4.15029895e-08, -0.961598694),
        CFrame.new(2124.39746, 103.50634, 3339.64087, 0.879151285, -9.63058611e-09, -0.476542771, 1.75668369e-08, 1, 1.21989494e-08, 0.476542771, -1.90960723e-08, 0.879151285),
    },

    ["Fisherman Island"] = {CFrame.new(-65.1821136, 3.53157115, 2775.68311, 0.33803311, 3.37374004e-08, 0.941134214,
        3.34767392e-09, 1, -3.7050004e-08, -0.941134214, 1.5674738e-08, 0.33803311)},
    ["Ancient Underground Celar"] = {CFrame.new(2100.39917, -91.1976471, -710.773804, 0.122371674, -6.42108589e-09,
        -0.992484331, 1.06256577e-08, 1, -5.15958387e-09, 0.992484331, -9.9144124e-09, 0.122371674)},
    ["Ancient Temple"] = {CFrame.new(1462.6908, -22.1250019, -672.93335, -0.147424042, -4.63247218e-08, 0.989073396,
        -9.93669929e-08, 1, 3.2025568e-08, -0.989073396, -9.35599047e-08, -0.147424042),
                          CFrame.new(1462.6908, -22.1250019, -672.93335, -0.147424042, -4.63247218e-08, 0.989073396,
        -9.93669929e-08, 1, 3.2025568e-08, -0.989073396, -9.35599047e-08, -0.147424042),
                          CFrame.new(1492.74304, -10.3161592, -586.368286, 0.322791666, -1.40727296e-08, -0.946470022,
        -6.17820533e-08, 1, -3.59392907e-08, 0.946470022, 7.00757639e-08, 0.322791666),
                          CFrame.new(1499.65027, -22.1250019, -641.448853, 0.993384957, -1.17929684e-08, 0.114831701,
        1.2063949e-08, 1, -1.66484504e-09, -0.114831701, 3.03915582e-09, 0.993384957)},
    ["Ancient Jungle Artifact"] = {CFrame.new(1500.73401, 6.62499952, -852.561646, -0.989423037, -1.68072827e-08,
        -0.1450589, -1.83718125e-08, 1, 9.44590894e-09, 0.1450589, 1.20109949e-08, -0.989423037),
                                   CFrame.new(1832.86194, 5.16533995, -325.743347, -0.183020815, -4.05987208e-08,
        -0.983109057, -3.93755393e-08, 1, -3.39658932e-08, 0.983109057, 3.24939826e-08, -0.183020815),
                                   CFrame.new(1381.57349, 4.61032534, 113.14798, -0.999778867, -4.56558924e-09,
        0.021029843, -4.14713286e-09, 1, 1.99418313e-08, -0.021029843, 1.98502068e-08, -0.999778867),
                                   CFrame.new(881.009094, 5.9040761, -342.943146, 0.21528995, 3.16417044e-08,
        0.976550162, -4.32311857e-08, 1, -2.28707808e-08, -0.976550162, -3.72935709e-08, 0.21528995)},
    ["Coral Reefs"] = {CFrame.new(-3118.39624, 2.42531538, 2135.26392, 0.92336154, -1.0069185e-07, -0.383931547,
        8.0607947e-08, 1, -6.84016968e-08, 0.383931547, 3.22115596e-08, 0.92336154),

                       CFrame.new(-2965.5708, 22.7500286, 2249.01709, 0.0730288103, 3.98725897e-09, 0.997329831,
        2.27064021e-08, 1, -5.6605951e-09, -0.997329831, 2.30591581e-08, 0.0730288103),
                       CFrame.new(-3102.16309, 5.97334528, 2218.88696, 0.758339584, 8.40698444e-09, -0.651859701,
        2.32941257e-08, 1, 3.99960918e-08, 0.651859701, -4.55151223e-08, 0.758339584)},
    ["Weather Machine"] = {CFrame.new(-1459.3772, 14.7103214, 1831.5188, 0.777951121, 2.52131862e-08, -0.628324807,
        -5.24126378e-08, 1, -2.47663063e-08, 0.628324807, 5.21991339e-08, 0.777951121),

                           CFrame.new(-1521.20862, 2.87499976, 1912.40564, -0.989418149, 1.00299182e-08, -0.14509216,
        6.85348089e-09, 1, 2.23923866e-08, 0.14509216, 2.11610462e-08, -0.989418149),
                           CFrame.new(-1574.57129, 13.1473379, 1920.83826, -0.816545427, -3.39974235e-08, 0.577281177,
        -6.96619793e-08, 1, -3.96422877e-08, -0.577281177, -7.25842781e-08, -0.816545427)},
    ["Sisyphus"] = {CFrame.new(-3765.69751, -135.074417, -906.893677, 0.704144239, 3.52946827e-08, -0.710056961,
        -3.45032909e-08, 1, 1.5490853e-08, 0.710056961, 1.35915084e-08, 0.704144239),
                    CFrame.new(-3780.09692, -135.074417, -962.226746, -0.366469413, -5.94525993e-08, -0.930430114,
        1.91083362e-08, 1, -7.14241963e-08, 0.930430114, -4.39537544e-08, -0.366469413)},
    ["Winter Fest"] = {CFrame.new(1820.92529, 5.7885952, 3305.04761, -0.290378898, 1.26296209e-08, -0.956911743,
        -2.8187932e-08, 1, 2.17520597e-08, 0.956911743, 3.32897017e-08, -0.290378898),
                       CFrame.new(1704.83362, 4.38193512, 3189.80811, 0.715091407, 8.31226021e-09, 0.699030936,
        -3.8851347e-08, 1, 2.78528525e-08, -0.699030936, -4.70756305e-08, 0.715091407)},
    ["Esoteric Depth"] = {CFrame.new(3272.27344, -1301.35535, 1390.97058, -0.422851175, -5.61508493e-08, -0.906199157,
        7.32285486e-08, 1, -9.6132986e-08, 0.906199157, -1.07009591e-07, -0.422851175)},
    ["Tropical Grove"] = {CFrame.new(-2126.49707, 53.4868774, 3640.20581, -0.872817099, 4.77880704e-08, 0.488047391,
        7.77828291e-09, 1, -8.40062881e-08, -0.488047391, -6.95259601e-08, -0.872817099)},
    ["Treasure Room"] = {CFrame.new(-3600.62988, -279.0737, -1692.755, -0.938830554, -1.7142467e-08, 0.344379485,
        -1.96833128e-08, 1, -3.8818464e-09, -0.344379485, -1.04229247e-08, -0.938830554),
                         CFrame.new(-3625.0708, -279.074219, -1594.57605, 0.918176472, -3.97606392e-09, -0.396171629,
        -1.12946204e-08, 1, -3.62128851e-08, 0.396171629, 3.77244298e-08, 0.918176472),
                         CFrame.new(-3600.72632, -276.06427, -1640.79663, -0.696130812, -6.0491181e-09, 0.717914939,
        -1.09490363e-08, 1, -2.19084972e-09, -0.717914939, -9.38559541e-09, -0.696130812),
                         CFrame.new(-3548.52222, -269.309845, -1659.26685, 0.0472991578, -4.08685423e-08, 0.998880744,
        -7.68598838e-08, 1, 4.45538149e-08, -0.998880744, -7.88812216e-08, 0.0472991578),
                         CFrame.new(-3581.84155, -279.09021, -1696.15637, -0.999634147, -0.000535600528, -0.0270430837,
        -0.000448358158, 0.999994695, -0.00323198596, 0.0270446707, -0.00321867829, -0.99962908),
                         CFrame.new(-3601.34302, -282.790955, -1629.37036, -0.526346684, 0.00143659476, 0.850268841,
        -0.000266355521, 0.999998271, -0.00185445137, -0.850269973, -0.00120255165, -0.526345372),
                         CFrame.new(-3601.52588, -282.991669, -1629.59265, -0.0535041578, -7.48535811e-08, 0.998567641,
        6.44989342e-08, 1, 7.84168677e-08, -0.998567641, 6.86021764e-08, -0.0535041578),
                         CFrame.new(-3594.76074, -275.663788, -1642.65515, 0.992020428, 2.66124651e-08, -0.126077324,
        -2.72226544e-08, 1, -3.11684589e-09, 0.126077324, 6.52413412e-09, 0.992020428)},
    ["Lost Shore"] = {CFrame.new(-3686.70557, 50.5551491, -802.862549, 0.671186864, -1.9727894e-08, 0.741288185,
        8.82212987e-08, 1, -5.32654987e-08, -0.741288185, 1.01148508e-07, 0.671186864),
                      CFrame.new(-3674.72852, 5.4255538, -860.631531, -0.995413721, 6.02128791e-09, 0.0956638828,
        3.38107586e-09, 1, -2.77609349e-08, -0.0956638828, -2.73101683e-08, -0.995413721)},
    ["Kohana Volcano"] = {CFrame.new(-648.832397, 45.2862358, 146.425705, -0.107698888, -2.22477787e-08, 0.99418354,
        2.75738845e-08, 1, 2.53649883e-08, -0.99418354, 3.01452836e-08, -0.107698888),
                          CFrame.new(-673.803223, 55.5000572, 183.610779, 0.122808129, 6.084327e-08, -0.992430449,
        -9.00719144e-08, 1, 5.01614039e-08, 0.992430449, 8.32298852e-08, 0.122808129),
                          CFrame.new(-675.741272, 55.5000572, 164.999741, 0.700404584, -6.1561245e-08, -0.713746011,
        7.66120891e-08, 1, -1.10708571e-08, 0.713746011, -4.69274966e-08, 0.700404584),

                          CFrame.new(-648.186584, 45.7505226, 172.17453, -0.995664299, 3.11417523e-08, 0.0930196419,
        3.00717424e-08, 1, -1.29047226e-08, -0.0930196419, -1.0051509e-08, -0.995664299)},
    ["Kohana"] = {CFrame.new(-658.677429, 20.0969162, 547.795715, 0.08832293, -2.84166846e-09, -0.996091902,
        1.26686484e-08, 1, -1.72949544e-09, 0.996091902, -1.24663835e-08, 0.08832293),
                  CFrame.new(-653.275757, 17.2500591, 490.213684, 0.223178998, 0, -0.97477746, 0, 1, 0, 0.97477746, 0,
        0.223178998)},
    ["Crater Island / Kawah"] = {CFrame.new(1066.1864, 57.2025681, 5045.5542, -0.682534158, 1.00865822e-08, 0.730853677,
        -5.8900711e-09, 1, -1.93017531e-08, -0.730853677, -1.74788859e-08, -0.682534158),
                                 CFrame.new(1057.28992, 33.0884132, 5133.79883, 0.833871782, 5.44149223e-08,
        0.551958203, -6.58184218e-09, 1, -8.86416984e-08, -0.551958203, 7.02829084e-08, 0.833871782),
                                 CFrame.new(988.954712, 42.8254471, 5088.71289, -0.849417388, -9.89310394e-08,
        0.527721584, -5.96115086e-08, 1, 9.15179328e-08, -0.527721584, 4.62786431e-08, -0.849417388),
                                 CFrame.new(1006.70685, 17.2302666, 5092.14844, -0.989664078, 5.6538525e-09,
        -0.143405005, 9.14879283e-09, 1, -2.3711717e-08, 0.143405005, -2.47786183e-08, -0.989664078),
                                 CFrame.new(1025.02356, 2.77259707, 5011.47021, -0.974474192, -6.87871804e-08,
        0.224499553, -4.47472104e-08, 1, 1.12170284e-07, -0.224499553, 9.92613209e-08, -0.974474192),
                                 CFrame.new(1071.14551, 3.528404, 5038.00293, -0.532300115, 3.38677708e-08, 0.84655571,
        6.69992914e-08, 1, 2.12149165e-09, -0.84655571, 5.7847906e-08, -0.532300115),
                                 CFrame.new(1022.55457, 16.6277809, 5066.28223, 0.721996129, 0, -0.691897094, 0, 1, 0,
        0.691897094, 0, 0.721996129),
                                 CFrame.new(1023.29114, 19.1177425, 5070.02588, 0.507022858, 2.01505461e-08,
        -0.861932635, 5.94909153e-08, 1, 5.83732387e-08, 0.861932635, -8.08737255e-08, 0.507022858),
                                 CFrame.new(981.318909, 41.6503983, 5078.02344, -0.0676535219, -6.19234299e-08,
        0.997708857, -2.32029294e-08, 1, 6.04922619e-08, -0.997708857, -1.90572536e-08, -0.0676535219)}
}
-- Fungsi teleport random
local function TeleportRandom()
    if not selectedIslands or #selectedIslands == 0 then
        WindUI:Notify({
            Title = "No Island Selected",
            Description = "Please select island to start auto farm",
            Duration = 1
        })
        return
    end

    -- Pilih pulau random dari yang dipilih
    local randomIsland = selectedIslands[math.random(1, #selectedIslands)]
    local points = TeleportPoints[randomIsland]

    if points and #points > 0 then
        local randomPoint = points[math.random(1, #points)]
        local hrp = game.Players.LocalPlayer.Character:WaitForChild("HumanoidRootPart")
        if hrp.Anchored then
            hrp.Anchored = false;
            task.wait(0.1)
        end
        hrp.CFrame = randomPoint

        if lockPositionState.enabled then
            lockPositionState.position = hrp.CFrame
        end

    end
end

-- autofarm toggle
AutoFarmTab:Paragraph({
    Title = "üé£ Auto Farm Settings",
    Desc = "Select one or more islands you want to farm, set the teleport threshold, and then toggle Autofarm to start.",
    Color = "Green",
    Locked = true
})

local islandNames = {}
for islandName, _ in pairs(TeleportPoints) do
    table.insert(islandNames, islandName)
    table.sort(islandNames);

end
local IslandDropdown = AutoFarmTab:Dropdown({
    Title = "Select Island(s)",
    Values = islandNames,
    Multi = true,
    AllowNone = true,
    Callback = function(option)
        selectedIslands = option

    end
})

local AutoFarmThreshold = 10
-- Input untuk threshold auto sell
local AutoFarmTh = AutoFarmTab:Input({
    Title = "Auto Teleport Threshold",
    Placeholder = "Default: 10",
    Value = 10,
    Type = "Input",
    Callback = function(input)
        local num = tonumber(input)
        if num then
            AutoFarmThreshold = num
            WindUI:Notify({
                Title = "Auto Farm Threshold Updated",
                Description = "The player will teleport to the island after reaching " .. num .. " fish",
                Duration = 1
            })
        else
            WindUI:Notify({
                Title = "Invalid Input",
                Description = "Please enter a number, not text.",
                Duration = 1
            })
        end

    end
})
toggleState.autoFarming = false
local AutoFarmToggle = AutoFarmTab:Toggle({
    Title = "Start Auto Farm",
    Default = false,
    Callback = function(value)
        toggleState.autoFarming = value

        if value then
            TeleportRandom()
            AutoFishingToggle:Set(value)
            startFishing(value)
        end

    end
})

----====AUTO FAVORITE========--
-- Favorite Legendary
local FavoriteMythic,favoriteVariant, VariantsFolder,FavoriteSecret,favoriteArtifact,favoriteArtifactToggle,FavoriteLegend
local SelectedFavoriteVariants = {}
do
 
  favoriteArtifactToggle = AutoFavoriteTab:Toggle({
    Title = "Favorite All Artifact",
    Desc = "Automatically favorite all Artifact items.",
    Default = true,
    Callback = function(state)
        favoriteArtifact = state 
    end
})

  FavoriteLegend = AutoFavoriteTab:Toggle({
    Title = "Favorite All Legendary",
    Desc = "Automatically favorite all Legendary items.",
    Default = false,
    Callback = function(state)
        FavoriteToggles.Legendary = state
        if state then
            task.spawn(function()
                favoriteTierLegend()
            end)
        end
    end
})

-- Favorite Mythical
 FavoriteMythic = AutoFavoriteTab:Toggle({
    Title = "Favorite All Mythical",
    Desc = "Automatically favorite all Mythical items.",
    Default = true,
    Callback = function(state)
        FavoriteToggles.Mythical = state
        if state then
            task.spawn(function()
                favoriteTierMythic()
            end)
        end

    end
})

FavoriteSecret  = AutoFavoriteTab:Toggle({
    Title = "Favorite All Secret",
    Desc = "Automatically favorite all Secret items.",
    Default = false,
    Callback = function(state)
        FavoriteToggles.Secret = state
        if state then
            task.spawn(function()
                favoriteTierSecret()
            end)
        end

    end
})
  VariantsFolder = replicatedStorage:WaitForChild("Variants")

local variantList = {}
for _, variant in ipairs(VariantsFolder:GetChildren()) do
    table.insert(variantList, variant.Name)
end


  favoriteVariant = AutoFavoriteTab:Dropdown({
    Title = "Select variant",
    Desc = "Select the variant tiers you want to favorite.",
    Values = variantList, -- semua rarity bisa dipilih
    Multi = true,
    AllowNone = false,
    Value = {}, -- harus table
    Callback = function(option)
        -- option = table hasil pilihan multi
        SelectedFavoriteVariants = option

    end
})

-- Button Favorite All
AutoFavoriteTab:Button({
    Title = "Favorite All",
    Desc = " Favorite all items.",
    Callback = function()
        task.spawn(function()
                    favoriteAll()

        end)
    end
})

-- Button UnFavorite All
AutoFavoriteTab:Button({
    Title = "UnFavorite All",
    Desc = "Remove favorite from all items.",
    Callback = function()
        unfavoriteAll()
    end
})

-- Variants

end
---playerconfig

 PlayerConfigTab:Toggle({
    Title = "Show Fish Price",
    Desc = "üõíShow Price Value on Inventory",
    Default = false,
    Callback = function(state)
        toggleState.priceValue = state
        updateInventoryLabels()
    end
})
local FloatPlayer = PlayerConfigTab:Toggle({
    Title = "Floating",
    Desc = "Make your character float in the air.",
    Default = false,
    Callback = function(state)
        toggleState.floatingPlatform = state
        floatPlat(state)

    end
})
local AcceptTrade
do

    -- ================== CONFIG ==================
    local CONFIG = {
        PromptName = "Prompt",
        YesButtonName = "Yes",
        ClicksPerSecond = 1,
        MaxSpamSeconds = 4,
        EdgePaddingFrac = 0.05,
        UseVIM = true,
        AlsoMoveMouse = false, -- mouse movement hidden
        UILoadDelay = 0.3,
        ClickDelay = 0.5,
        RetryDelay = 0.2,
        StopOnTextMatches = {"trade completed!", "trade successful"},
        StopOnFailMatches = {"trade cancelled", "trade failed"},
        RayfieldEnabled = true
    }

    -- ================== STATE ==================
    local VirtualInputManager = game:GetService("VirtualInputManager")
    local GuiService = game:GetService("GuiService")
    local ReplicatedStorage = game:GetService("ReplicatedStorage")

    local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

    local running, spamming = false, false
    local stopRequested = false
    local spamThread = nil
    local promptGui = nil
    local yesButton = nil
    local promptEnabledConn = nil
    local textNotifRE = nil
    local notifConn = nil

    -- ================== HELPERS ==================
    local function isButtonValid(button)
        return button and button.Parent and button.Visible and button.Active and button.AbsoluteSize.Magnitude > 0 and
                   button:IsDescendantOf(PlayerGui)
    end
    local function getPromptGui()
        local g = PlayerGui:FindFirstChild(CONFIG.PromptName)
        return g and g:IsA("ScreenGui") and g or nil
    end
    local function getPromptText()
        local gui = getPromptGui()
        if not gui then
            return nil
        end

        local textObj = gui:FindFirstChildWhichIsA("TextLabel", true)

        return textObj and textObj.Text or nil
    end

    local function isValidPrompt()
        local txt = getPromptText()
        if not txt then
            return false
        end

        txt = txt:lower() -- biar ga sensitif huruf besar/kecil
        return txt:find("accept") and txt:find("from") or false
    end

    local function findYesButton(gui)

        if not gui then
            return nil
        end
        for _, child in ipairs(gui:GetDescendants()) do
            if isValidPrompt() and child:IsA("ImageButton") and child.Name == CONFIG.YesButtonName then
                if isButtonValid(child) then
                    return child
                end
            end
        end
        return nil
    end
    local function getButtonRect(button)
        local absPos, absSize = button.AbsolutePosition, button.AbsoluteSize
        local guiInset = GuiService:GetGuiInset()
        return {
            X = absPos.X,
            Y = absPos.Y + guiInset.Y,
            W = absSize.X,
            H = absSize.Y
        }
    end

    local function pointInRect(rect)
        local pad = math.clamp(CONFIG.EdgePaddingFrac, 0, 0.49)
        local minX, maxX = rect.X + rect.W * pad, rect.X + rect.W * (1 - pad)
        local minY, maxY = rect.Y + rect.H * pad, rect.Y + rect.H * (1 - pad)

        -- Ambil titik tetap: tengah
        local x = (minX + maxX) / 2
        local y = (minY + maxY) / 2

        return x, y
    end
    LocalPlayer.PlayerGui:WaitForChild("Prompt").ChildAdded:Connect(function(child)
        if child.Name == "Blackout" then
            local options = child:WaitForChild("Options")
            local yesBtn = options:WaitForChild("Yes")
            yesBtn.Active = true
            yesBtn.Visible = true
        end
    end)
    local function clickXY(x, y)
        if CONFIG.UseVIM and VirtualInputManager then
            pcall(function()
                if CONFIG.AlsoMoveMouse then
                    VirtualInputManager:SendMouseMoveEvent(x, y, game)
                    task.wait(CONFIG.ClickDelay)
                end
                VirtualInputManager:SendMouseButtonEvent(x, y, 0, true, game, 0)
                task.wait(CONFIG.ClickDelay)
                VirtualInputManager:SendMouseButtonEvent(x, y, 0, false, game, 0)
            end)
        elseif yesButton and isButtonValid(yesButton) then
            pcall(function()
                yesButton.MouseButton1Click:Fire()
            end)
        end
    end

    local function stopSpam()
        stopRequested = true
        for _ = 1, 50 do
            if not spamming then
                break
            end
            task.wait(0.01)
        end
        spamming = false
    end

    local function waitForButtonReady(gui, maxWait)
        local deadline = tick() + (maxWait or 2)
        while tick() < deadline do
            local button = findYesButton(gui)
            if button and isButtonValid(button) then
                return button
            end
            task.wait(0.05)
        end
        return nil
    end

    local function startSpam()
        if spamming then
            return
        end
        yesButton = waitForButtonReady(promptGui, 2)
        if not yesButton then
            return
        end

        local rect = getButtonRect(yesButton)
        spamming = true
        stopRequested = false

        spamThread = task.spawn(function()
            local startTime = tick()
            local clickCount = 0
            while spamming and running and not stopRequested do
                if not isButtonValid(yesButton) then
                    break
                end
                if clickCount % 5 == 0 then
                    local currentRect = getButtonRect(yesButton)
                    if currentRect then
                        rect = currentRect
                    end
                end
                local x, y = pointInRect(rect)
                clickXY(x, y)
                clickCount = clickCount + 1

                local base = 1 / math.clamp(CONFIG.ClicksPerSecond, 6, 40)
                task.wait(base) -- tanpa jitter, delay tetap sama setiap klik

                if tick() - startTime > CONFIG.MaxSpamSeconds then
                    break
                end
            end
            spamming = false
        end)
    end

    local function bindTextNotifications()
        if notifConn then
            notifConn:Disconnect();
            notifConn = nil
        end
        textNotifRE = textNotifRE or ReplicatedStorage:FindFirstChild("RE/TextNotification")
        if textNotifRE and textNotifRE:IsA("RemoteEvent") then
            notifConn = textNotifRE.OnClientEvent:Connect(function(payload)
                local txt = type(payload) == "table" and payload.Text or payload
                if not txt then
                    return
                end
                local t = tostring(txt):lower()
                for _, k in ipairs(CONFIG.StopOnTextMatches) do
                    if string.find(t, k:lower(), 1, true) then
                        stopSpam();
                        return
                    end
                end
                for _, k in ipairs(CONFIG.StopOnFailMatches) do
                    if string.find(t, k:lower(), 1, true) then
                        stopSpam();
                        return
                    end
                end
            end)
        end
    end

    local function onPromptEnabledChanged()
        if not running or not promptGui then
            return
        end
        if promptGui.Enabled then
            task.delay(CONFIG.UILoadDelay, startSpam)
        else
            stopSpam()
        end
    end

    local function bindPrompt()
        if promptEnabledConn then
            promptEnabledConn:Disconnect()
        end
        promptGui = getPromptGui()
        if not promptGui then
            return
        end
        promptEnabledConn = promptGui:GetPropertyChangedSignal("Enabled"):Connect(onPromptEnabledChanged)
    end

    -- ================== PUBLIC FUNCTIONS ==================
    local function Init(opts)
        opts = opts or {}
        for k, v in pairs(opts) do
            if CONFIG[k] ~= nil then
                CONFIG[k] = v
            end
        end
        bindTextNotifications()
    end

    local function Start()
        if running then
            return
        end
        running = true
        bindPrompt()
        task.delay(CONFIG.UILoadDelay, function()
            if running and promptGui and promptGui.Enabled then
                startSpam()
            end
        end)
    end

    local function Stop()
        if not running then
            return
        end
        running = false
        stopSpam()
    end

    local function SetYesButtonName(name)
        CONFIG.YesButtonName = name
    end

    local function ToggleRayfield(enable)
        CONFIG.RayfieldEnabled = enable
        CONFIG.UseVIM = enable
        if not enable then
            Stop()
        end
    end

    AcceptTrade = PlayerConfigTab:Toggle({
        Title = "AutoAcceptTrade",
        Default = false,
        Callback = function(Value)
            if Value then
                ToggleRayfield(true)
                Start()
            else
                ToggleRayfield(false)
            end
        end
    })

    Init({
        RayfieldEnabled = false
    })
end

-- buyrodtab --

-- Fungsi untuk format angka jadi readable string
local function formatPrice(num)
    if not num or type(num) ~= "number" then
        return "???"
    end
    if num >= 1e6 then
        return string.format("%.1fM Coins", num / 1e6)
    elseif num >= 1e3 then
        return string.format("%.1fk Coins", num / 1e3)
    else
        return tostring(num) .. " Coins"
    end
end
-- ================= Rods =================
local rods = {}
for _, module in ipairs(ItemsFolder:GetChildren()) do
    if module:IsA("ModuleScript") then
        local success, data = pcall(require, module)
        if success and typeof(data) == "table" then
            local rodData = data.Data
            if rodData and rodData.Type == "Fishing Rods" then
                local id = rodData.Id or "?"
                local name = rodData.Name or module.Name
                local desc = rodData.Description or "-"
                local price = "???"

                if data.Price then
                    price = formatPrice(data.Price)
                    table.insert(rods, {
                        ID = id,
                        Name = name,
                        Dex = desc,
                        Harga = price
                    })

                end

            end
        end
    end
end

do
 
BuyRodTab:Section({
    Title = "Traveling Merchant",
})

--// === VARIABLES ===
local merchant
local selectedItem
local merchantItems = {}
local autoBuyEnabled = false
local autoBuyLoop
local quantityToBuy = 1
  local Replion = require(replicatedStorage.Packages.Replion)
    local ItemUtility = require(replicatedStorage.Shared.ItemUtility)

    local MarketItemData = require(replicatedStorage.Shared.MarketItemData)
    local RFPurchaseMarketItem = replicatedStorage.Packages._Index["sleitnick_net@0.2.0"].net["RF/PurchaseMarketItem"]

--// === FUNCTIONS ===
local function FetchMerchantItems()
  
    merchant = Replion.Client:WaitReplion("Merchant")
    merchantItems = {}

    for _, itemId in ipairs(merchant:GetExpect("Items")) do
        for _, v in pairs(MarketItemData) do
            if v.Id == itemId then
                local itemInfo = ItemUtility.GetItemDataFromItemType(v.Type, v.Identifier)
                if itemInfo and itemInfo.Data then
                    table.insert(merchantItems, {
                        Id = itemId,
                        Name = itemInfo.Data.Name,
                        Price = v.Price,
                        Currency = v.Currency
                    })
                end
            end
        end
    end

    return merchantItems
end

local function BuyItem(itemId, quantity)
    for i = 1, quantity do
        pcall(function()
            RFPurchaseMarketItem:InvokeServer(itemId)
        end)
        task.wait(0.25)
    end
end

local function StartAutoBuy()
    if autoBuyLoop then
        task.cancel(autoBuyLoop)
    end

    autoBuyLoop = task.spawn(function()
        while autoBuyEnabled and selectedItem do
            WindUI:Notify({
                Title = "Auto Buy",
                Content = "Buying " .. quantityToBuy .. "x " .. selectedItem.Name,
                Duration = 1
            })
            BuyItem(selectedItem.Id, quantityToBuy)
            task.wait(10)
        end
    end)
end

--// === WINDUI ELEMENTS ===
local itemDropdown = BuyRodTab:Dropdown({
    Title = "Select Item",
    Desc = "Choose which item to buy",
    Values = {},
    Multi = false,
    Callback = function(choice)
        for _, v in pairs(merchantItems) do
            if v.Name == choice then
                selectedItem = v
                WindUI:Notify({
                    Title = "Item Selected",
                    Content = "Selected " .. v.Name .. " (" .. v.Price .. " " .. v.Currency .. ")",
                    Duration = 1
                })
                break
            end
        end
    end
})

local qtyInput = BuyRodTab:Input({
    Title = "Quantity",
    Placeholder = "Enter quantity (default 1)",
    Callback = function(input)
        quantityToBuy = tonumber(input) or 1
        WindUI:Notify({
            Title = "Quantity Updated",
            Content = "Buying x" .. quantityToBuy,
            Duration = 1
        })
    end
})

BuyRodTab:Button({
    Title = "üîÑ Refresh Merchant",
    Callback = function()
        local items = FetchMerchantItems()
        local itemNames = {}
        for _, item in ipairs(items) do
            table.insert(itemNames, item.Name)
        end

        itemDropdown:Refresh(itemNames)
        WindUI:Notify({
            Title = "Merchant Refreshed",
            Content = "Loaded " .. #itemNames .. " items from merchant.",
            Duration = 2
        })
    end
})

BuyRodTab:Button({
    Title = "üí∏ Buy Selected Item",
    Callback = function()
        if not selectedItem then
            WindUI:Notify({
                Title = "Error",
                Content = "No item selected!",
                Duration = 1
            })
            return
        end

        BuyItem(selectedItem.Id, quantityToBuy)
        WindUI:Notify({
            Title = "Purchase Complete",
            Content = "Bought " .. quantityToBuy .. "x " .. selectedItem.Name,
            Duration = 1
        })
    end
})

local AutoBuyToggle = BuyRodTab:Toggle({
    Title = "Auto Buy",
    Desc = "Automatically buy the selected item repeatedly",
    Default = false,
    Callback = function(state)
        autoBuyEnabled = state
        if state then
            WindUI:Notify({
                Title = "Auto Buy Enabled",
                Content = "Auto buying will start...",
                Duration = 1
            })
            StartAutoBuy()
        else
            WindUI:Notify({
                Title = "Auto Buy Disabled",
                Content = "Stopped auto buying.",
                Duration = 1
            })
        end
    end
})

-- Load first time
local items = FetchMerchantItems()
local names = {}
for _, v in ipairs(items) do
    table.insert(names, v.Name)
end
itemDropdown:Refresh(names)


end


BuyRodTab:Paragraph({
    Title = "Rod",
    Desc = "Some Rods can't be purchased because they are VIP only or doesn't have a price map.",
    Color = "Red"
})

for _, rod in ipairs(rods) do
    BuyRodTab:Button({
        Title = string.format("%s (%s)", rod.Name, rod.Harga),
        Callback = function()
            local success, result = pcall(function()
                return
                    replicatedStorage.Packages._Index["sleitnick_net@0.2.0"].net["RF/PurchaseFishingRod"]:InvokeServer(
                        rod.ID)
            end)

            WindUI:Notify({
                Title = "Purchase Rod",
                Description = success and ("Buying " .. rod.Name) or ("Failed to buy " .. rod.Name),
                Duration = 2
            })

            if not success then
                warn("[Buy Rod Error]:", result)
            end
        end
    })
end

-- ================= Baits =================

local BaitsFolder = replicatedStorage:FindFirstChild("Baits")
if not BaitsFolder then
    warn("‚ö†Ô∏è Baits folder not found in ReplicatedStorage")
    return
end
BuyRodTab:Paragraph({
    Title = "Bait/Bobber",
    Desc = "Some Rods can't be purchased because they are VIP only or doesn't have a price map.",
    Color = "Red"
})
for _, baitModule in ipairs(BaitsFolder:GetChildren()) do
    if baitModule:IsA("ModuleScript") then
        local success, baitData = pcall(require, baitModule)
        if success and baitData and baitData.Data then
            local id = baitData.Data.Id or 0
            local name = baitData.Data.Name or "Unknown"
            local desc = baitData.Data.Description or "-"
            local priceText = baitData.Price and (baitData.Price .. " Coins") or "No Price"

            BuyRodTab:Button({
                Title = name .. " (" .. priceText .. ")",
                Callback = function()
                    pcall(function()
                        replicatedStorage.Packages._Index["sleitnick_net@0.2.0"].net["RF/PurchaseBait"]:InvokeServer(id)

                    end)
                end
            })

        end
    end
end
-- Simpan state asli untuk restore
local originalStates = {}

local function saveOriginalStates()
    originalStates.Terrain = {
        WaterWaveSize = Workspace.Terrain.WaterWaveSize,
        WaterWaveSpeed = Workspace.Terrain.WaterWaveSpeed,
        WaterReflectance = Workspace.Terrain.WaterReflectance
    }

    originalStates.Parts = {}
    originalStates.Decals = {}
    originalStates.Meshes = {}

    for _, v in pairs(game:GetDescendants()) do
        if v:IsA("BasePart") then
            originalStates.Parts[v] = {
                Color = v.Color,
                Material = v.Material,
                Reflectance = v.Reflectance,
                CastShadow = v.CastShadow,
                Transparency = v.Transparency
            }
        elseif v:IsA("Decal") or v:IsA("Texture") then
            originalStates.Decals[v] = {
                Transparency = v.Transparency,
                Texture = v.Texture
            }
        elseif v:IsA("SpecialMesh") then
            originalStates.Meshes[v] = {
                TextureId = v.TextureId
            }
        end
    end
end
saveOriginalStates()
local function applyLowTexture()
    saveOriginalStates()

    local terrain = Workspace.Terrain
    local LocalPlayer = game:GetService("Players").LocalPlayer

    -- Terrain
    if sethiddenproperty then
        sethiddenproperty(terrain, "WaterWaveSize", 0)
        sethiddenproperty(terrain, "WaterWaveSpeed", 0)
        sethiddenproperty(terrain, "WaterReflectance", 0)
    else
        terrain.WaterWaveSize = 0
        terrain.WaterWaveSpeed = 0
        terrain.WaterReflectance = 0
    end

    -- Optimize parts & decals
    for _, v in pairs(game:GetDescendants()) do
        if v:IsA("BasePart") then
            -- Lewati karakter pemain
            if not (LocalPlayer and v:IsDescendantOf(LocalPlayer.Character)) then
                v.Material = Enum.Material.SmoothPlastic
                v.Color = Color3.fromRGB(120, 120, 120) -- abu-abu netral
                v.Reflectance = 0
                v.CastShadow = false
            end
        elseif v:IsA("Decal") or v:IsA("Texture") then
            -- Jangan hilangkan wajah karakter
            if not (v.Name == "face" and v.Parent:IsA("Head")) then
                v.Transparency = 1
                v.Texture = ""
            end
        elseif v:IsA("ParticleEmitter") or v:IsA("Trail") or v:IsA("Beam") then
            v.Enabled = false
        elseif v:IsA("SurfaceAppearance") then
            v:Destroy()
        elseif v:IsA("SpecialMesh") then
            v.TextureId = ""
        end
    end

    -- Turunkan detail mesh dan kualitas render
    settings().Rendering.MeshPartDetailLevel = Enum.MeshPartDetailLevel.Level01
    settings().Rendering.QualityLevel = Enum.QualityLevel.Level01
end

local function restoreOriginal()
    if not originalStates then
        return
    end
    local terrain = Workspace.Terrain

    -- Restore terrain
    if originalStates.Terrain then
        terrain.WaterWaveSize = originalStates.Terrain.WaterWaveSize
        terrain.WaterWaveSpeed = originalStates.Terrain.WaterWaveSpeed
        terrain.WaterReflectance = originalStates.Terrain.WaterReflectance
    end

    -- Restore parts
    for part, state in pairs(originalStates.Parts) do
        if part and part.Parent then
            for k, v in pairs(state) do
                part[k] = v
            end
        end
    end

    -- Restore decals/textures
    for decal, state in pairs(originalStates.Decals) do
        if decal and decal.Parent then
            for k, v in pairs(state) do
                decal[k] = v
            end
        end
    end

    -- Restore special meshes
    for mesh, state in pairs(originalStates.Meshes) do
        if mesh and mesh.Parent then
            for k, v in pairs(state) do
                mesh[k] = v
            end
        end
    end
end
-- Simpan pengaturan awal
local defaultLighting = {
    ClockTime = Lighting.ClockTime,
    Brightness = Lighting.Brightness,
    OutdoorAmbient = Lighting.OutdoorAmbient,
    Ambient = Lighting.Ambient,
    FogStart = Lighting.FogStart,
    FogEnd = Lighting.FogEnd,
    Sky = Lighting:FindFirstChildOfClass("Sky") and Lighting:FindFirstChildOfClass("Sky"):Clone() or nil
}

local function setNight()
    Lighting.ClockTime = 0
    Lighting.Brightness = 0.5
    Lighting.OutdoorAmbient = Color3.fromRGB(10, 10, 10)
    Lighting.Ambient = Color3.fromRGB(5, 5, 5)
    Lighting.FogStart = 0
    Lighting.FogEnd = 100000

    -- Hapus Sky yang ada dan buat baru
    Lighting:ClearAllChildren()
    local Sky = Instance.new("Sky")
    Sky.SkyboxBk = ""
    Sky.SkyboxDn = ""
    Sky.SkyboxFt = ""
    Sky.SkyboxLf = ""
    Sky.SkyboxRt = ""
    Sky.SkyboxUp = ""
    Sky.SunAngularSize = 0
    Sky.MoonAngularSize = 0
    Sky.StarCount = 0
    Sky.Parent = Lighting
end

local function restoreLighting()
    Lighting.ClockTime = defaultLighting.ClockTime
    Lighting.Brightness = defaultLighting.Brightness
    Lighting.OutdoorAmbient = defaultLighting.OutdoorAmbient
    Lighting.Ambient = defaultLighting.Ambient
    Lighting.FogStart = defaultLighting.FogStart
    Lighting.FogEnd = defaultLighting.FogEnd

    Lighting:ClearAllChildren()
    if defaultLighting.Sky then
        local skyClone = defaultLighting.Sky:Clone()
        skyClone.Parent = Lighting
    end
end

-- Dark Mode Toggle
local savedNight = false
local darkNight = PlayerConfigTab:Toggle({
    Title = "Dark / Night Mode",
    Default = false,
    Callback = function(Value)
        savedNight = Value
        if savedNight then
            setNight()
        else
            restoreLighting()
        end
    end
})

-- Opsional: jaga agar lighting malam terus aktif tiap frame (kalau diinginkan)
RunService.RenderStepped:Connect(function()
    if savedNight then
        setNight()
    end
end)
-- Toggle Anti Lag
local antilagValue = false
local antiLag = PlayerConfigTab:Toggle({
    Title = "Anti Lag / Low Texture",
    Description = "Reduce textures for better FPS",
    Default = true,
    Callback = function(Value)
        antilagValue = Value
        if Value then
            applyLowTexture()
        else
            restoreOriginal()
        end

    end
})

local render3d = PlayerConfigTab:Toggle({
    Title = "Disable 3D Render",
    Description = "Disable render for better FPS",
    Default = false,
    Callback = function(Value)
        if Value then
            pcall(function()
                RunService:Set3dRenderingEnabled(false)
            end)

        else
            pcall(function()
                RunService:Set3dRenderingEnabled(true)
            end)
        end

    end
})
local function disableNotif(value)
    local gui = player.PlayerGui:WaitForChild("Small Notification")
    local display = gui:WaitForChild("Display")

    for _, child in ipairs(display:GetChildren()) do
        if child:IsA("GuiObject") then
            child.Visible = value
        end
    end
end
local fishCaughtNotif = PlayerConfigTab:Toggle({
    Title = "Disable Fish Caught Notification",
    Default = true,
    Callback = function(Value)
        if Value then
            disableNotif(false)
        else
            disableNotif(true)
        end

    end
})
local CutsceneManager = {
    Disabled = false,
    CutsceneController = require(game:GetService("ReplicatedStorage").Controllers.CutsceneController),
    OriginalPlay = nil,
    OriginalStop = nil
}

function CutsceneManager.SaveOriginal()
    if not CutsceneManager.OriginalPlay then
        CutsceneManager.OriginalPlay = CutsceneManager.CutsceneController.Play
    end
    if not CutsceneManager.OriginalStop then
        CutsceneManager.OriginalStop = CutsceneManager.CutsceneController.Stop
    end
end

-- Disable Cutscene
function CutsceneManager.Disable()
    if CutsceneManager.Disabled then
        return
    end
    CutsceneManager.Disabled = true
    CutsceneManager.SaveOriginal()

    CutsceneManager.CutsceneController.Play = function(_, ...)
        local GuiControl = require(replicatedStorage.Modules.GuiControl)
        local ProximityPromptService = game:GetService("ProximityPromptService")
        local QuestController = require(replicatedStorage.Controllers.QuestController)

        -- Aktifkan kembali HUD & Prompt
        GuiControl:SetHUDVisibility(true)
        ProximityPromptService.Enabled = true
        if QuestController:IsEnabled() == false then
            QuestController:SetEnabled(true)
        end
    end

    CutsceneManager.CutsceneController.Stop = function(...)
        CutsceneManager.OriginalStop(...)
    end
end

-- Enable Cutscene
function CutsceneManager.Enable()
    if not CutsceneManager.Disabled then
        return
    end
    CutsceneManager.Disabled = false
    CutsceneManager.SaveOriginal()

    CutsceneManager.CutsceneController.Play = CutsceneManager.OriginalPlay
    CutsceneManager.CutsceneController.Stop = CutsceneManager.OriginalStop
end

local CutsceneToggle = PlayerConfigTab:Toggle({
    Title = "Disable Cutscene Animation",
    Default = false,
    Callback = function(value)
        if value then
            CutsceneManager.Disable()
        else
            CutsceneManager.Enable()
        end

    end
})
local FishingRadarToggle = PlayerConfigTab:Toggle({
    Title = "Fishing Radar",
    Default = false,
    Callback = function(value)
        local Net = require(replicatedStorage.Packages.Net)
        local UpdateFishingRadar = Net:RemoteFunction("UpdateFishingRadar")
        UpdateFishingRadar:InvokeServer(value)

    end
})

local saveLastPosition = PlayerConfigTab:Toggle({
    Title = "Auto Save & Restore Last Position",
    Default = false,
    Callback = function(state)
        AutoSaveEnabled = state 
    end
})

local LockPosition = PlayerConfigTab:Toggle({
    Title = "Lock Player Position",
    Default = false,
    Callback = function(value)
        lockPositionState.enabled = value
        if not value then
            lockPositionState.position = nil
        elseif toggleState.autoFishing and player.Character and player.Character.PrimaryPart then
            lockPositionState.position = player.Character.PrimaryPart.CFrame
        end

    end
})

task.spawn(function()
    while task.wait(10) do
        if lockPositionState.enabled and lockPositionState.position and player.Character and
            player.Character.PrimaryPart then
            player.Character.PrimaryPart.CFrame = lockPositionState.position
        end
    end
end)

-- abouttab
local customUrl, DiscordId,webhookTier,enableWebhook,inputLink

do 
local floatToggle = false
HomeTab:Section({
    Title = "Find Me"
})

HomeTab:Paragraph({
    Title = "FREE AND KEYLESS SCRIPT",
    Desc = "This script is free to use and does not require any key or password. Please do not sell this script.",
    Image = "send",
    Buttons = {{
        Title = "Copy Link",
        Icon = "copy",
        Variant = "Tertiary",
        Callback = function()
            setclipboard("https://saweria.co/Eznaw")
            WindUI:Notify({
                Title = "Copied!",
                Content = "Github link copied to clipboard.",
                Duration = 1
            })
        end
    }}
})
HomeTab:Paragraph({
    Title = "Discord",
    Desc = "https://discord.gg/6Pd8TEMzNJ",
    Image = "message-square",
    Buttons = {{
        Title = "Copy Link",
        Icon = "copy",
        Variant = "Tertiary",
        Callback = function()
            setclipboard("https://discord.gg/6Pd8TEMzNJ")
            WindUI:Notify({
                Title = "Copied!",
                Content = "Discord link copied to clipboard.",
                Duration = 1
            })
        end
    }}
})

HomeTab:Paragraph({
    Title = "GitHub",
    Desc = "Aldi Pranata",
    Image = "send",
    Buttons = {{
        Title = "Copy Link",
        Icon = "copy",
        Variant = "Tertiary",
        Callback = function()
            setclipboard("https://github.com/aldyjrz")
            WindUI:Notify({
                Title = "Copied!",
                Content = "Github link copied to clipboard.",
                Duration = 1
            })
        end
    }}
})

-- Bagian Local Player
ServerInfo:Section({
    Title = "üë§ Local Player"
})

ServerInfo:Paragraph({
    Title = "üÜî Player ID",
    Desc = tostring(player.UserId),
    Buttons = {{
        Title = "Copy",
        Icon = "copy",
        Variant = "Tertiary",
        Callback = function()
            setclipboard(tostring(player.UserId))
        end
    }}
})

-- Bagian Server Info
ServerInfo:Section({
    Title = "üåê Server Info"
})

ServerInfo:Paragraph({
    Title = "üè∑Ô∏è Place ID",
    Desc = tostring(game.PlaceId),
    Buttons = {{
        Title = "Copy",
        Icon = "copy",
        Variant = "Tertiary",
        Callback = function()
            setclipboard(tostring(game.PlaceId))
        end
    }}
})

-- ‚úÖ Tambahkan Copy Link Server
local serverLink

serverLink = string.format("https://www.roblox.com/games/start?placeId=%d&gameInstanceId=%s", game.PlaceId, game.JobId)

ServerInfo:Paragraph({
    Title = "üîó Server Link",
    Desc = "Click Copy to Share/Join",
    Buttons = {{
        Title = "Copy Link",
        Icon = "link",
        Variant = "Primary",
        Callback = function()
            setclipboard(serverLink)
            WindUI:Notify({
                Title = "Copied!",
                Content = "Server link copied to clipboard."
            })
        end
    }}
})

 
  inputLink = ServerInfo:Input({
    Title = "Input Server Link",
    Placeholder = "Enter your Server Link",
    Callback = function(input)
        toggleState.joinLink = input

    end
})
ServerInfo:Button({
    Title = "Join Server Link",
    Callback = function()
        local link = toggleState.joinLink
        if not link or link == "" then
            WindUI:Notify({
                Title = "Link Error",
                Content = "Link belum di input",
                Duration = 1
            })
            return
        end

        local placeId, jobId

        -- Case 1: Link langsung ke instance publik
        if link:find("placeId=") and link:find("gameInstanceId=") then
            placeId = link:match("placeId=(%d+)")
            jobId = link:match("gameInstanceId=([%w%-]+)")

            -- Case 2: Link private server (share link)
        elseif link:find("share%?code=") then
            -- Contoh link: https://www.roblox.com/share?code=ABC123&type=Server
            jobId = link:match("code=([%w%-]+)")
            placeId = game.PlaceId -- asumsi tetap di game yg sama
        end

        if not placeId or not jobId then
            WindUI:Notify({
                Title = "Error",
                Content = "Gagal parsing placeId atau jobId dari link",
                Duration = 2
            })
            return
        end

        -- Convert ke number untuk placeId
        placeId = tonumber(placeId)

        -- Coba teleport ke instance / job id
        local success, err = pcall(function()
            TeleportService:TeleportToPlaceInstance(placeId, jobId, LocalPlayer)
        end)

        if not success then
            WindUI:Notify({
                Title = "Teleport Failed",
                Content = tostring(err),
                Duration = 2
            })
        end
    end
})
local function Rejoin()
    local player = Players.LocalPlayer
    if player then
        TeleportService:Teleport(game.PlaceId, player)
    end
end
ServerInfo:Button({
    Title = "Rejoin Server",
    Callback = function()
        Rejoin()
    end
})

local function ServerHop()
    local placeId = game.PlaceId
    local servers = {}
    local cursor = ""
    local found = false

    repeat
        local url = "https://games.roblox.com/v1/games/" .. placeId .. "/servers/Public?sortOrder=Asc&limit=100"
        if cursor ~= "" then
            url = url .. "&cursor=" .. cursor
        end

        local success, result = pcall(function()
            return HttpService:JSONDecode(game:HttpGet(url))
        end)

        if success and result and result.data then
            for _, server in pairs(result.data) do
                if server.playing < server.maxPlayers and server.id ~= game.JobId then
                    table.insert(servers, server.id)
                end
            end
            cursor = result.nextPageCursor or ""
        else
            break
        end
    until not cursor or #servers > 0

    if #servers > 0 then
        local targetServer = servers[math.random(1, #servers)]
        WindUI:Notify({
            Title = "Success",
            Content = "Teleporting to new server",
            Duration = 1
        })
        TeleportService:TeleportToPlaceInstance(placeId, targetServer, LocalPlayer)
    else
        WindUI:Notify({
            Title = "Error",
            Content = "No Server Available",
            Duration = 1
        })
    end
end
ServerInfo:Button({
    Title = "Server Hop (Random Server)",
    Callback = function()
        ServerHop()
    end
})

 
local runtimeLabel = ""

if toggleState.priceValue then
    updateInventoryLabels()
end
local function findItemModule(fullName)
    local itemsFolder = replicatedStorage:FindFirstChild("Items")
    if not itemsFolder then
        return nil
    end
    local cleanedName = fullName:gsub("%s*%b()", ""):gsub("^%s*(.-)%s*$", "%1")
    local bestMatch, longestMatchLength = nil, 0
    for _, itemModule in ipairs(itemsFolder:GetChildren()) do
        if itemModule:IsA("ModuleScript") then
            if cleanedName:find(itemModule.Name, 1, true) then
                if #itemModule.Name > longestMatchLength then
                    longestMatchLength = #itemModule.Name

                    bestMatch = itemModule
                end
            end
        end
    end
    return bestMatch
end
task.spawn(function()
    while task.wait(1800) do
        local elapsed = os.time() - startTime
        local minutes = math.floor(elapsed / 60)
        local seconds = elapsed % 60
        runtimeLabel = string.format("%d:%02d (Minutes:Second)", minutes, seconds)
    end
end)
Webhook:Section({
    Title = "Webhook Configuration"
})

 enableWebhook = Webhook:Toggle({
    Title = "Enable FishCaught Webhook",
    Default = true,
    Callback = function(value)
        webhookSetting.enabled = value

        -- kalau dimatikan, putuskan semua koneksi
        if not value then
            if webhookSetting.connection and webhookSetting.connection.Connected then
                webhookSetting.connection:Disconnect()
                webhookSetting.connection = nil
            end
            return
        end

        -- kalau dinyalakan
        task.spawn(function()
            while webhookSetting.enabled do
                task.wait(1)

                local smallNotif = player.PlayerGui:FindFirstChild("Small Notification")
                if not (smallNotif and smallNotif.Enabled) then
                    if webhookSetting.connection and webhookSetting.connection.Connected then
                        webhookSetting.connection:Disconnect()
                        webhookSetting.connection = nil
                    end

                end

                -- kalau sudah ada koneksi aktif, skip
                if webhookSetting.connection and webhookSetting.connection.Connected then

                end

                -- cari container baru
                local container = smallNotif:FindFirstChild("Display", true) and
                                      smallNotif.Display:FindFirstChild("Container", true)

                if container then
                    local itemNameLabel = container:FindFirstChild("ItemName", true)
                    local rarityLabel = container:FindFirstChild("Rarity", true)

                    if itemNameLabel and rarityLabel then
                        webhookSetting.connection = itemNameLabel:GetPropertyChangedSignal("Text"):Connect(function()
                            local currentTime = os.time()

                            local fullFishName = itemNameLabel.Text
                            if fullFishName == "" or fullFishName == webhookSetting.lastFish then
                                return
                            end

                            webhookSetting.lastFish = fullFishName
                            webhookSetting.lastSend = currentTime

                            -- ambil data ikan
                            local itemModule = findItemModule(fullFishName)
                            if not itemModule then
                                return
                            end

                            local s, itemData = pcall(require, itemModule)
                            if not (s and itemData and itemData.Data) then
                                return
                            end
                            local rarityChance = itemData.Probability.Chance;
                            local tierNumber = itemData.Data.Tier
                            local uuid = itemData.UUID

                            local tierData = TierUtility.GetTierFromRarity(nil, rarityChance)
                            local tierName = tierData.Name

                            if #webhookSetting.selectedTiers > 0 and
                                not table.find(webhookSetting.selectedTiers, tierName) then
                                return
                            end

                            local assetId = itemData.Data.Icon and itemData.Data.Icon:match("%d+")
                            local sellPrice = itemData.SellPrice
                            local rarityText = rarityLabel.Text
                            local weight = fullFishName:match("%((.+)%)")
                            local cleanedFishName = fullFishName:gsub("%s*%b()%s*$", "")

                            local totalCaught, bagSize = "Unknown", "Unknown"
                            local leaderstats = player:FindFirstChild("leaderstats")
                            if leaderstats and leaderstats:FindFirstChild("Caught") then
                                totalCaught = tostring(leaderstats.Caught.Value)
                            end

                            if backpackGui then
                                local display = backpackGui:FindFirstChild("Display")
                                local inventory = display and display:FindFirstChild("Inventory")
                                local bagSizeLabel = inventory and inventory:FindFirstChild("BagSize")

                                if bagSizeLabel and bagSizeLabel:IsA("TextLabel") then
                                    bagSize = bagSizeLabel.Text
                                    local currentStr = bagSize:match("^(%d+)") -- "3000"

                                    local current = tonumber(currentStr) 
                                    if current and current >= 4000 then
                                        Remotes.RF_SellAllItems:InvokeServer() 
                                    end
                                end

                            end
                            local Counter = LocalPlayer:WaitForChild("PlayerGui"):WaitForChild("Events"):WaitForChild(
                                "Frame"):WaitForChild("CurrencyCounter"):WaitForChild("Counter")
                            local totalCoin = Counter.Text or "0"
                            local rodName = getRodUsed() or "??"

                            -- kirim ke proxy PHP
                            sendDataToDiscord({
                                discordId = webhookSetting.discordId,
                                robloxUsername = player.Name,
                                fishName = cleanedFishName,
                                weight = weight,
                                rarity = rarityText,
                                assetId = assetId,
                                tierName = tierName,
                                sellPrice = sellPrice,
                                totalCaught = totalCaught,
                                bagSize = bagSize,
                                totalCoin = totalCoin,
                                rodName = rodName,
                                totalPlay = runtimeLabel

                            })
                        end)

                    end

                end
            end
        end)
    end
})

  webhookTier = Webhook:Dropdown({
    Title = "Select Tier",
    Desc = "Select which fish tiers to send to webhook",
    Values = rarityList, -- semua rarity bisa dipilih
    Multi = true,
    AllowNone = true,
    Value = {"Legendary", "Mythic", "SECRET"}, -- harus table
    Callback = function(option)
        webhookSetting.selectedTiers = option

    end
})
  DiscordId = Webhook:Input({
    Title = "Discord User ID (Optional)",
    Placeholder = "Enter your Discord ID",
    Callback = function(input)
        if input then
            webhookSetting.discordId = input
        end

    end
})
  customUrl = Webhook:Input({
    Title = "Custom Webhook URL",
    Desc = "You can use your own webhook URL instead of the default one.",
    Placeholder = "Enter your Discord webhook URL",

    Callback = function(value)

        webhookSetting.customUrl = value

    end
})

Webhook:Button({
    Title = "Test Custom Webhook Url ",
    Desc = "Send test data to your webhook URL",
    Callback = function()
        if not webhookSetting.customUrl or webhookSetting.customUrl == "" then
            WindUI:Notify({
                Title = "Error",
                Content = "Please enter a valid webhook URL.",
                Duration = 2
            })
            return
        end
        -- kalau dinyalakan
        task.spawn(function()
            sendDataToDiscord({
                customUrl = webhookSetting.customUrl,
                discordId = DiscordId.Text or "No ID",
                robloxUsername = player.Name,
                fishName = "Test Fish",
                weight = "10.5 kg",
                rarity = "1/10000000",
                assetId = "71039584468574",
                tierName = "SECRET",
                sellPrice = "10000M",
                totalCaught = "9999",
                bagSize = "1000/3000",
                totalCoin = "500M",
                rodName = "Daido Dark Knight",
                totalPlay = "1110:10 (Minutes:Second)"

            })
            WindUI:Notify({
                Title = "Data Sent Sucessfully",
                Content = "Check your discord webhook channel.",
                Duration = 2
            })
        end)
    end

})
end
local DropdownTotems, ToggleAutoSpawn
 
local RESpawnTotem = replicatedStorage.Packages._Index["sleitnick_net@0.2.0"].net["RE/SpawnTotem"]

-- === Ambil daftar Totem di inventory ===
local inv = Data:Get("Inventory")
local totems = inv and inv["Totems"]

if not totems then
	warn("‚ùå Tidak ada key 'Totems' di Inventory.")
	return
end

local TotemsFolder = replicatedStorage:FindFirstChild("Totems")
if not TotemsFolder then
	warn("‚ùå Folder 'Totems' tidak ditemukan di ReplicatedStorage.")
	return
end

-- üß† Ambil nama Totem berdasarkan ID
local function getTotemNameById(id)
	for _, module in ipairs(TotemsFolder:GetChildren()) do
		if module:IsA("ModuleScript") then
			local success, data = pcall(require, module)
			if success and data.Data and data.Data.Id == id then
				return data.Data.Name or module.Name
			end
		end
	end
	return "Unknown"
end

-- üß© Buat daftar nama Totem + UUID Map
local TotemList, TotemUUIDMap = {}, {}
for _, itemData in pairs(totems) do
	local name = getTotemNameById(itemData.Id)
	table.insert(TotemList, name)
	TotemUUIDMap[name] = itemData.UUID
end

local selectedTotem = TotemList[1] or nil
local autoSpawnEnabled = false
do

    MiscTab:Button({
        Title = "Trick or Treats",
        Callback = function()
               game:GetService("ReplicatedStorage"):WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild(
                "sleitnick_net@0.2.0"):WaitForChild("net"):WaitForChild("RF/SpecialDialogueEvent"):InvokeServer("Relukt", "TrickorTreatHouse")
 
        for _, npc in ipairs(replicatedStorage:WaitForChild("NPC"):GetChildren()) do
               game:GetService("ReplicatedStorage"):WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild(
                "sleitnick_net@0.2.0"):WaitForChild("net"):WaitForChild("RF/SpecialDialogueEvent"):InvokeServer(npc.Name, "TrickOrTreat")
    game:GetService("ReplicatedStorage"):WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild(
                "sleitnick_net@0.2.0"):WaitForChild("net"):WaitForChild("RF/SpecialDialogueEvent"):InvokeServer(npc.Name, "TrickorTreatHouse")
 
        end

         end

    })
-- üéõÔ∏è Dropdown pilih Totem (WindUI)
  DropdownTotems = MiscTab:Dropdown({
	Title = "Select Totem",
	Desc = "Pilih Totem untuk di-spawn otomatis",
	Values = TotemList,
	Value = selectedTotem,
	Callback = function(value)
		selectedTotem = value
		WindUI:Notify({
			Title = "Totem Selected",
			Content = "Selected Totem: " .. tostring(value),
			Duration = 2
		})
	end
})

-- üß† Fungsi bantu: ambil data Totem dari folder
local function getTotemDataById(id)
	for _, module in ipairs(TotemsFolder:GetChildren()) do
		if module:IsA("ModuleScript") then
			local success, data = pcall(require, module)
			if success and data.Data and data.Data.Id == id then
				return data.Data
			end
		end
	end
	return nil
end

-- üîç Cari slot di EquippedItems
local function getTotemSlot(uuid)
	local equippedItems = Data:Get("EquippedItems")
	if equippedItems then
		for i, itemUUID in ipairs(equippedItems) do
			if itemUUID == uuid then
				return i
			end
		end
	end
	return nil
end

-- ‚ö° Fungsi utama untuk equip & spawn totem
local function equipAndSpawnTotem(uuid)
	if not uuid then return end
 
	-- Equip item dulu
	Remotes.RE_EquipItem:FireServer(uuid, "Totems")

	-- Tunggu sedikit supaya Replion update
	task.wait(0.5)

	-- Cek slot totem
	local totemSlot = getTotemSlot(uuid)
	if not totemSlot then
		--warn("‚ö†Ô∏è Gagal menemukan slot totem untuk UUID:", uuid)
		return
	end

	-- Equip tool slot + spawn
	Remotes.RE_EquipTool:FireServer(totemSlot)
	task.wait(0.5)
	RESpawnTotem:FireServer(uuid)

	--print("‚úÖ Totem spawned:", uuid)
end

-- üîÅ Auto spawn loop
task.spawn(function()
	while task.wait(1) do
		if autoSpawnEnabled then
			local uuid = TotemUUIDMap[selectedTotem]
			if uuid then
				equipAndSpawnTotem(uuid)
			end
		end
        task.wait(3600)
	end
end)

-- üü¢ Toggle untuk Auto Spawn (WindUI)
  ToggleAutoSpawn = MiscTab:Toggle({
	Title = "Auto Spawn Totem",
	Desc = "Aktifkan untuk spawn otomatis",
	Default = false,
	Callback = function(state)
		autoSpawnEnabled = state
		if state then
			WindUI:Notify({
				Title = "Auto Totem",
				Content = "Auto Spawn Totem diaktifkan.",
				Duration = 2
			})
		else
			WindUI:Notify({
				Title = "Auto Totem",
				Content = "Auto Spawn Totem dimatikan.",
				Duration = 2
			})
		end
	end
})
 
end

do
    -- ambil key TempleLevers
    local templeLevers = Data:Get("TempleLevers")

     if templeLevers == nil then
         return
    end

    -- daftar lever lengkap (agar yang false tetap muncul)
    local allLevers = {"Hourglass Diamond Artifact", "Arrow Artifact", "Diamond Artifact", "Crescent Artifact"}

    -- buat paragraf status
    local lines = {}
    for _, leverName in ipairs(allLevers) do
        if templeLevers[leverName] then
            table.insert(lines, "‚úÖ " .. leverName .. " Owned")
        else
            table.insert(lines, "‚ùå " .. leverName .. " Not Owned")
        end
    end

    local HRP = player.Character and player.Character:WaitForChild("HumanoidRootPart")

    -- Lokasi setiap artifact
    local artifactLocations = {
        ["Hourglass Diamond Artifact"] = CFrame.new(1500.73401, 6.62499952, -852.561646, -0.989423037, -3.72535142e-10,
            -0.1450589, -4.55259663e-10, 1, 5.37087097e-10, 0.1450589, 5.97445815e-10, -0.989423037),
        ["Diamond Artifact"] = CFrame.new(1833.32751, 4.84496784, -325.866364, -0.087324582, 1.52306168e-08,
            -0.996179938, 1.66916152e-08, 1, 1.38258445e-08, 0.996179938, -1.54205164e-08, -0.087324582),
        ["Arrow Artifact"] = CFrame.new(879.856628, 5.12086105, -342.661469, -0.214729846, -6.23545873e-08, 0.976673484,
            3.37955726e-08, 1, 7.127408e-08, -0.976673484, 4.83119109e-08, -0.214729846),
        ["Crescent Artifact"] = CFrame.new(1380.41638, 2.73220325, 115.727127, -0.688028514, 1.07027894e-07, 0.72568363,
            7.20888025e-08, 1, -7.91374291e-08, -0.72568363, -2.13514517e-09, -0.688028514)
    }

    -- ID item artifact
    local artifactIds = {
        ["Arrow Artifact"] = 265,
        ["Crescent Artifact"] = 266,
        ["Diamond Artifact"] = 267,
        ["Hourglass Diamond Artifact"] = 271
    }

    -- Remote untuk pasang lever

    -- === Ambil status dari Replion ===
    local function GetTempleLeverStatus()

        local localReplion = require(replicatedStorage:WaitForChild("Packages"):WaitForChild("Replion"))

        local DataReplion = localReplion.Client:WaitReplion("Data")
        if not DataReplion then
            return {}, {}
        end

         local inventoryItems = DataReplion:Get({"Inventory", "Items"}) or {}

        local ownedArtifacts = {}
        for _, item in ipairs(inventoryItems) do
            for name, id in pairs(artifactIds) do
                if item.Id == id then
                    ownedArtifacts[name] = true
                end
            end
        end

        return templeLevers, ownedArtifacts
    end

    local function AllLeversPlaced()
        local templeLever, _ = GetTempleLeverStatus() -- Ambil hanya data lever

        for name, _ in pairs(artifactIds) do
            if not templeLever[name] then
                return false
            end
        end
        return true
    end
    -- === Refresh paragraf status artifact ===
            local templeLever, ownedArtifacts = GetTempleLeverStatus()

    local function RefreshArtifactParagraph()
        local placedLines = {}

        for name, _ in pairs(artifactIds) do
            table.insert(placedLines, string.format("%s %s",
                templeLever[name] and "‚öôÔ∏è Lever Placed:" or "‚õî Not Placed:", name))
        end

        local finalText = table.concat(placedLines, "\n")

        if AllLeversPlaced() then
            finalText = finalText .. "\n\n‚úÖ Semua lever sudah ditempatkan!"
        end

        return finalText
    end


    -- === Buat paragraf UI ===
    local artifactParagraph = MiscTab:Paragraph({

        Title = "Temple Artifact Progress",
        Desc = RefreshArtifactParagraph()
    })
     -- === Fungsi Auto Farm Artifact ===
    local function TeleportToArtifact(artifactName)
        if HRP and artifactLocations[artifactName] then
            HRP.CFrame = artifactLocations[artifactName]
            task.wait(0.2)
            WindUI:Notify({
                Title = "Teleporting",
                Content = "Teleported to " .. artifactName .. " location. Starting fishing...",
                Duration = 2
            })
            startFishing(false)
            AutoFishingToggle:Set(false)
            AutoFarmToggle:Set(false)
            toggleState.autoFarming = false
            toggleState.autoFishing = false

            startFishing(true)
        end
    end
 
    local function AutoFarmArtifacts()

        for name, _ in pairs(artifactIds) do
            local owned = ownedArtifacts[name]
            local leverPlaced = templeLevers[name]

            if not owned then
                -- print("[üé£] Belum punya " .. name .. " ‚Üí teleport dan mulai fishing.")
                TeleportToArtifact(name)
                return
            elseif owned and not leverPlaced then
                WindUI:Notify({
                    Title = "Placing Lever",
                    Content = "Placing lever for " .. name,
                    Duration = 1
                })
                Remotes.RE_PlaceLeverItem:FireServer(name)
                task.wait(1)
            end
        end
    end

    -- === Toggle WindUI ===
    MiscTab:Toggle({
        Title = "Auto Farm Artifact & Place Levers",
        Desc = "Automatically farms missing artifacts and places temple levers (Realtime Progress).",
        Default = false,
        Callback = function(val)
            toggleState.autoArtifact = val
            if val then
                if AllLeversPlaced() then
                     WindUI:Notify({
                    Title = "All of artifacts has been placed",
                    Content = "Quest completed",
                    Duration = 1
                })
                    artifactParagraph:SetDesc(RefreshArtifactParagraph())
                    return
                end

                task.spawn(function()
                    startFishing(val)

                    AutoFarmArtifacts()

                    while toggleState.autoArtifact do
                        
                        for name, _ in pairs(artifactIds) do
                            local owned = ownedArtifacts[name]
                            local leverPlaced = templeLevers[name]

                            if not owned then 
                                return
                            elseif owned and not leverPlaced then 
                                Remotes.RE_PlaceLeverItem:FireServer(name)
                                task.wait(2)
                                AutoFarmArtifacts()
                            end
                        end
                        
                        artifactParagraph:SetDesc(RefreshArtifactParagraph())
                        task.wait(7)
                    end
                end)
            else
                startFishing(false)
            end
        end
    })

    -- Player Tab
    MiscTab:Toggle({
        Title = "Infinity Jump",
        Default = false,
        Callback = function(val)
            toggleState.infJump = val
        end
    })

    UserInputService.JumpRequest:Connect(function()
        if toggleState.infJump and LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid") then
            LocalPlayer.Character:FindFirstChildOfClass("Humanoid"):ChangeState("Jumping")
        end
    end)

    -- Delay Slider
    MiscTab:Slider({
        Title = "Walk Speed",
        Value = {
            Min = 15,
            Max = 500,
            Default = 15
        },
        Step = 5,
        Callback = function(val)
            local hum = LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
            if hum then
                hum.WalkSpeed = val
            end
        end
    })
end

do

    -- // Section: Advanced
    -- =========trade========--
    local tradeSet = {
        selectedPlayerName = nil,
        selectedPlayerId = nil,
        selectedItemName = nil,
        itemQty = 0,
        autoTradeStart = false,
        filterUnfavorited = false
    }

    AutoTradeTab:Section({
        Title = "Auto Trade"
    })

    local ItemStringUtility, localReplion, localItemUtility
    local modulesLoaded = false

    local function loadModuleReplion()
        if modulesLoaded then
            return true
        end
        local success = pcall(function()
            localReplion = require(replicatedStorage:WaitForChild("Packages"):WaitForChild("Replion"))
            localItemUtility = require(replicatedStorage:WaitForChild("Shared"):WaitForChild("ItemUtility"))
            ItemStringUtility = require(replicatedStorage:WaitForChild("Modules"):WaitForChild("ItemStringUtility"))
        end)
        if success then
            modulesLoaded = true
            return true
        end
        return false
    end

    local tradeStatus

    local function getPlayerListV2()
        local list = {};
        for _, p in ipairs(Players:GetPlayers()) do
            if p ~= player then
                table.insert(list, p.Name)
            end
        end
        table.sort(list);
        return list
    end
    tradeStatus = AutoTradeTab:Paragraph({
        Title = "Status",
        Desc = "Waiting to start trade"
    })
    if not loadModuleReplion() then
        if tradeStatus then
            tradeStatus:SetDesc("Error loading replion data.")
        end
        return
    end
    local filterRegex = function(selected)
        if type(selected) == "table" then
            selected = selected[1] -- ambil pilihan pertama kalau table
        end
        if type(selected) == "string" then
            -- Buang "(9x)" atau "(Qty : 92)"
            return selected:match("^(.-)%s*%(%d+x%)$") -- format lama
            or selected:match("^(.-)%s*%(%s*Qty%s*:%s*%d+%s*%)$") -- format baru
            or selected
        end
        return nil
    end
    
   
     
    getgenv().oldNamecall = hookmetamethod(game, "__namecall", newcclosure(function(self, ...)
        local method = getnamecallmethod()
        local args = {...}

        if method == "FireServer" and tostring(self) == "URE/UpdateOxygen" then
            return nil -- prevent call
        end

        return getgenv().oldNamecall(self, unpack(args))
    end))

    AutoTradeTab:Section({
        Title = "Auto Trade"
    })

    local inventoryDropdown = AutoTradeTab:Dropdown({
        Title = "Select Fish from Backpack",
        Desc = "Only unfavorited Fishes and Enchant Stones are listed",
        Values = {"Refresh to load items..."},
        Multi = false,
        AllowNone = true,
        Callback = function(val)
            tradeSet.selectedItemName = val
        end
    })

    local playerDropdownV2 = AutoTradeTab:Dropdown({
        Title = "Select Target",
        Desc = "Select player to trade with",
        Values = getPlayerListV2(),
        AllowNone = true,
        Multi = false,
        Callback = function(v)
            tradeSet.selectedPlayerName = v -- Options adalah array
            local charactersFolder = Workspace:FindFirstChild("Characters")
            local targetChar = charactersFolder:FindFirstChild(tradeSet.selectedPlayerName)
            if targetChar then
                local targetPlayer = Players:GetPlayerFromCharacter(targetChar)
                if targetPlayer then
                    local targetHRP = targetChar.HumanoidRootPart
                    tradeSet.selectedPlayerId = targetPlayer.UserId
                end
            end
            print("Selected player:", tradeSet.selectedPlayerName)
            print("Selected player ID:", tradeSet.selectedPlayerId)
        end
    })

    local inventoryCache = {}
    local inventoryDropdownList = {}

    local function refreshInventory()
        local DataReplion = localReplion.Client:WaitReplion("Data")
        if not DataReplion then
            return
        end
        local inventoryItems = DataReplion:Get({"Inventory", "Items"})
        local groupedItems = {}
        inventoryCache = {}

        inventoryDropdownList = {}
        inventoryDropdown:Refresh(inventoryDropdownList)

        if not inventoryItems then
            return
        end

        for _, itemData in ipairs(inventoryItems) do
            local baseItemData = localItemUtility:GetItemData(itemData.Id)
            if baseItemData and baseItemData.Data and
                (baseItemData.Data.Type == "Fishes" or baseItemData.Data.Type == "EnchantStones") then
                if not itemData.Favorited then
                    local dynamicName = ItemStringUtility.GetItemName(itemData, baseItemData)

                    if not groupedItems[dynamicName] then
                        groupedItems[dynamicName] = 0
                        inventoryCache[dynamicName] = {}
                    end

                    groupedItems[dynamicName] = groupedItems[dynamicName] + 1
                    table.insert(inventoryCache[dynamicName], itemData.UUID)
                end
            end
        end

        for name, count in pairs(groupedItems) do
            table.insert(inventoryDropdownList, string.format("%s (Qty : %d)", name, count))
        end
        table.sort(inventoryDropdownList)

        inventoryDropdown:Refresh(inventoryDropdownList)
        playerDropdownV2:Refresh(getPlayerListV2())
    end

    AutoTradeTab:Button({
        Title = "Refresh Backpack",
        Callback = function()
            inventoryDropdown:Refresh({})

            refreshInventory()
            WindUI:Notify({
                Title = "Inventory Refreshed",
                Content = "Backpack items have been refreshed.",
                Duration = 2
            })
        end

    })

    refreshInventory()

    AutoTradeTab:Input({
        Desc = "Enter the quantity of the selected item to trade.",
        Title = "Quantity to Trade",
        Placeholder = "5",
        Type = "Input",
        Callback = function(val)
            tradeSet.itemQty = tonumber(val) or 0
        end
    })

    Players.PlayerAdded:Connect(function()
        if playerDropdownV2 and not playerDropdownV2.Opened then
            playerDropdownV2:Refresh(getPlayerListV2())
        end
    end)
    Players.PlayerRemoving:Connect(function()
        if playerDropdownV2 and not playerDropdownV2.Opened then
            playerDropdownV2:Refresh(getPlayerListV2())
        end
    end)

    AutoTradeTab:Toggle({
        Title = "Start Trade!",
        Value = false,
        Callback = function(value)
            tradeSet.autoTradeStart = value
            if value then
                local successCount, failCount = 0, 0

                task.spawn(function()

                    local character = LocalPlayer.Character
                    local hrp = character and character:FindFirstChild("HumanoidRootPart")
                    local charactersFolder = Workspace:FindFirstChild("Characters")
                    local targetChar = charactersFolder:FindFirstChild(tradeSet.selectedPlayerName)
                     local targetPlayer = Players:GetPlayerFromCharacter(targetChar)
                    if not targetPlayer then
                        tradeStatus:SetDesc("Error invalid target player.")
                        return
                    end

                    local targetHRP = targetChar:FindFirstChild("HumanoidRootPart")
                    if not targetHRP then
                        tradeStatus:SetDesc("Error can't find target character HRP position.")
                        return
                    end

                    if not tradeSet.selectedPlayerId then
                        tradeStatus:SetDesc("Error item, quantity or player can't be empty or null.")
                        tradeSet.autoTradeStart = false
                        return
                    end
                    hrp.CFrame = targetHRP.CFrame
                    task.wait(0.5)

                    -- ‚úÖ Loop semua item yang dipilih
                    local selectedItem = tradeSet.selectedItemName
                    local cleanItemName = filterRegex(selectedItem) or selectedItem
                    local uuidsToSend = inventoryCache[cleanItemName]

                    if not uuidsToSend or #uuidsToSend == 0 then
                        tradeStatus:SetDesc("No items found for " .. cleanItemName)
                    end
                    if not uuidsToSend or #uuidsToSend < tradeSet.itemQty then
                        tradeStatus:SetDesc({
                            Title = "Error",
                            Content = "Not enough items for " .. cleanItemName
                        })
                        tradeSet.autoTradeStart = false
                        return
                    end

                  

                    local initiateTradeFunc = replicatedStorage:WaitForChild("Packages"):WaitForChild("_Index")
                        :WaitForChild("sleitnick_net@0.2.0"):WaitForChild("net"):WaitForChild("RF/InitiateTrade")

                    -- ‚úÖ Kirim semua UUID untuk item ini
                    for i = 1, tradeSet.itemQty do
                        if not tradeSet.autoTradeStart then
                            tradeStatus:SetDesc("Trade stopped.")
                            return
                        end
                        local uuid = uuidsToSend[i]
                        local success, result = pcall(initiateTradeFunc.InvokeServer, initiateTradeFunc,
                            tradeSet.selectedPlayerId, uuid)

                        if success and result then
                            successCount = successCount + 1
                            tradeStatus:SetDesc(string.format("[%s] Success: %d | Fail: %d", cleanItemName,
                                successCount, failCount))
                        else
                            failCount = failCount + 1
                            tradeStatus:SetDesc(string.format("[%s] Failed to trade (%d/%d)", cleanItemName,
                                successCount, failCount))
                        end

                        task.wait(7)
                    end

                    tradeStatus:SetDesc(string.format("‚úÖ All Trades Complete.\nSuccess: %d | Failed: %d",
                        successCount, failCount))

                    tradeSet.autoTradeStart = false
                    refreshInventory()
                end)
            end
        end
    })

end
-----===trade end====----
local autoBuyWeatherDropdown, autoBuyWeatherToggle
---===weather===---

    local weatherSet = {
        enabled = false,
        selectedWeathers = {}
    }
do


    local weathersData = {{
        Name = "Wind",
        Price = 10000
    }, {
        Name = "Snow",
        Price = 15000
    }, {
        Name = "Cloudy",
        Price = 20000
    }, {
        Name = "Storm",
        Price = 35000
    }, {
        Name = "Radiant",
        Price = 50000
    }, {
        Name = "Shark Hunt",
        Price = 300000
    }}
    table.sort(weathersData, function(a, b)
        return a.Price < b.Price
    end)

    local weatherNames = {}
    for _, weather in ipairs(weathersData) do
        table.insert(weatherNames, weather.Name)
    end

    local function buySelectedWeather()
        if   #weatherSet.selectedWeathers == 0 then
            return
        end
        for _, weatherName in ipairs(weatherSet.selectedWeathers) do
            pcall(function()
                game:GetService("ReplicatedStorage"):WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild(
                    "sleitnick_net@0.2.0"):WaitForChild("net"):WaitForChild("RF/PurchaseWeatherEvent"):InvokeServer(weatherName)
            end)
            task.wait(1)
        end
    end
    autoBuyWeatherToggle = BuyWeatherTab:Toggle({
        Title = "Auto Buy Weather",
        Desc = "Automatically buy selected weather every 10 seconds",
        Value = false,
        Callback = function(value)
            weatherSet.enabled = value
            if value then
                buySelectedWeather()
                task.spawn(function()
                    while weatherSet.enabled do
                        task.wait(15)
                        if not weatherSet.enabled then
                            break
                        end
                        buySelectedWeather()
                    end
                end)
            end
        end
    })

    autoBuyWeatherDropdown = BuyWeatherTab:Dropdown({
        Title = "Select Weather to Spam",
        Values = weatherNames,
        Multi = true,
        AllowNone = true,
        Callback = function(value)
            weatherSet.selectedWeathers = value
        end
    })

    BuyWeatherTab:Section({
        Title = "Click To Buy"
    })
    for _, weatherData in ipairs(weathersData) do
        local buttonTitle = string.format("%s", weatherData.Name)
        BuyWeatherTab:Button({
            Title = buttonTitle,
            Callback = function()
                pcall(function()
                    game:GetService("ReplicatedStorage"):WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild(
                        "sleitnick_net@0.2.0"):WaitForChild("net"):WaitForChild("RF/PurchaseWeatherEvent"):InvokeServer(weatherData.Name)
                end)
            end
        })
    end
end
----===== weather end ======

---===enchantntab -----
 local selectedEnchants = {}
    local enchantingRunning,enchantToggle = false,false
 
do
    getgenv().statusEnchant = EnchantTab:Paragraph({
        Title = "Status",
        Desc = "Waiting to start enchant",
        Color = "Green"
    })

    local altarCFrame = Vector3.new(3231, -1303, 1402)
    local EnchantingController = replicatedStorage:WaitForChild("Controllers"):WaitForChild("EnchantingController")
    local Enchants = replicatedStorage:WaitForChild("Enchants")

    -- Ambil semua nama enchant
    local function getAllEnchantNames()
        local names = {}
        for _, enchantModule in ipairs(Enchants:GetChildren()) do
            if enchantModule:IsA("ModuleScript") then
                local data = require(enchantModule)
                if data and data.Data and data.Data.Name then
                    table.insert(names, data.Data.Name)
                end
            end
        end
        table.sort(names)
        return names
    end

   

    local function getEnchantStones()
        local inv = Data:Get("Inventory")
        if not inv or not inv.Items then
            return nil
        end

        for _, itemData in pairs(inv.Items) do
            if type(itemData) == "table" and itemData.Id == 10 then
                return tostring(itemData.UUID) -- langsung return string
            end
        end
        return nil -- kalau tidak ada item id=10
    end
    -- Dropdown multiple (WindUI)
    EnchantTab:Dropdown({
        Title = "Select Enchant",
        Values = getAllEnchantNames(),
        Multi = true,
        AllowNone = false,
        Value = {}, -- default kosong
        Callback = function(selected)
            selectedEnchants = selected or {}

            if #selectedEnchants > 0 then
                getgenv().statusEnchant:SetDesc("‚úÖ Enchant dipilih: " .. table.concat(selectedEnchants, ", "))
            else
                getgenv().statusEnchant:SetDesc("‚ùå Error: No Enchant selected.")
            end
        end
    })

    -- Helper functions
    local function contains(tbl, val)
        for _, v in ipairs(tbl) do
            if v == val then
                return true
            end
        end
        return false
    end
 
    local localReplion = require(replicatedStorage:WaitForChild("Packages"):WaitForChild("Replion"))
    local ItemUtility = require(replicatedStorage:WaitForChild("Shared"):WaitForChild("ItemUtility"))

    local function getStoneBar()
        local DataReplion = localReplion.Client:WaitReplion("Data")
        local equippedItems = DataReplion:Get("EquippedItems")
        if equippedItems then
            for i, uuid in ipairs(equippedItems) do
                local invItems = DataReplion:Get({"Inventory", "Items"})
                if invItems then
                    for _, itemData in ipairs(invItems) do
                        if itemData.UUID == uuid then
                            local baseData = ItemUtility:GetItemData(itemData.Id)
                            if baseData and baseData.Data.Type == "EnchantStones" then
                                return i
                            end
                        end
                    end
                end
            end
        end
        return nil
    end
    -- Toggle start enchant
    EnchantTab:Toggle({
        Title = "Start Enchant Rod",
        Default = false,
        Callback = function(val)
            enchantToggle = val
            if val then
                if #selectedEnchants == 0 then
                    getgenv().statusEnchant:SetDesc("‚ùå Error: No Enchant selected.")
                    return
                end

                enchantingRunning = true
                getgenv().statusEnchant:SetDesc("Mulai proses enchant... Mencari " )

                -- Teleport ke altar
                local char = Workspace:WaitForChild("Characters"):FindFirstChild(LocalPlayer.Name)
                local hrp = char and char:FindFirstChild("HumanoidRootPart")
                if hrp then
                    hrp.CFrame = CFrame.new(altarCFrame)
                end

                -- Loop enchant
                task.spawn(function()
                    while enchantingRunning do
                        local uuid = getEnchantStones() -- fungsi kamu
                        if not uuid then
                            getgenv().statusEnchant:SetDesc("‚ùå Batu habis! Berhenti.")
                            enchantingRunning = false
                            break
                        end
                        local stoneHotbarSlot = getStoneBar()
                        local success = pcall(function()
                            Remotes.RE_EquipItem:FireServer(uuid, "EnchantStones")
                            task.wait(0.2)
                            Remotes.RE_EquipTool:FireServer(stoneHotbarSlot)
                            task.wait(0.2)
                            Remotes.RE_ActivateEnchantingAltar:FireServer()
                        end)

                        if not success then
                            getgenv().statusEnchant:SetDesc("‚ö†Ô∏è Error saat enchant. Hentikan.")
                            enchantingRunning = false
                            break
                        end

                        task.wait(1)
                    end
                end)
            else
                enchantingRunning = false
                getgenv().statusEnchant:SetDesc("Enchanting stopped.")
            end
        end
    })

    -- Cek enchant hasil roll
    local function getEnchantById(id)
        for _, enchantModule in ipairs(Enchants:GetChildren()) do
            if enchantModule:IsA("ModuleScript") then
                local data = require(enchantModule)
                if data and data.Data and data.Data.Id == id then
                    return data
                end
            end
        end
        return nil
    end
    Remotes.RERollEnchant.OnClientEvent:Connect(function(rollId, enchantId, slot, isFree)
        if not enchantingRunning then
            return
        end

        local enchantData = getEnchantById(enchantId)
        if enchantData then
            local name = enchantData.Data.Name

            if contains(selectedEnchants, name) then
                getgenv().statusEnchant:SetDesc("‚úÖ Enchant Found!: " .. name .. "\nRoll Completed.")
                enchantingRunning = false
            else
                getgenv().statusEnchant:SetDesc("Found : " .. name .. "\nTry Again...")
            end
        end
    end)
end

-- ==== enchant tab end ====--
---=== teleport island ===---
do

    local islandLocation = {
        ["01"] = {
            name = "Crater Island",
            position = Vector3.new(1014.896, 20.921, 5071.434)
        },
        ["02"] = {
            name = "Treasure Room",
            position = Vector3.new(-3598.539, -279.646, -1634.287)
        },
        ["03"] = {
            name = "Lost Shore",
            position = Vector3.new(-3677, 107, -912)
        },
        ["04"] = {
            name = "Fisherman Island",
            position = Vector3.new(-2.382, 4.5, 2839.47)
        },
        ["05"] = {
            name = "Tropical Grove",
            position = Vector3.new(-2051.413, 6.268, 3662)
        },
        ["06"] = {
            name = "Esoteric Depths",
            position = Vector3.new(3209.068, -1302.855, 1411.844)
        },
        ["07"] = {
            name = "Esoteric Island",
            position = Vector3.new(2031.415, 27.397, 1394.621)
        },
        ["08"] = {
            name = "Kohana",
            position = Vector3.new(-678.811, 4.935, 708.578)
        },
        ["09"] = {
            name = "Kohana Volcano",
            position = Vector3.new(-516.92, 22, 191)
        },
        ["10"] = {
            name = "Sisyphus",
            position = Vector3.new(-3667.556, -135.574, -900.99)
        },
        ["11"] = {
            name = "Weather Machine",
            position = Vector3.new(-1471, -3, 1929)
        },
        ["12"] = {
            name = "Winter Fest",
            position = Vector3.new(1611, 4, 3280)
        },
        ["13"] = {
            name = "Coral Reefs",
            position = Vector3.new(-2949.694, 63.25, 2248.52)
        },
        ["14"] = {
            name = "Ancient Jungle",
            position = Vector3.new(1268.92908, 7.83907604, -183.376709, 0.939863861, 2.36314772e-08, -0.341549337,
                -9.28303567e-09, 1, 4.36443202e-08, 0.341549337, -3.78491052e-08, 0.939863861)
        },
        ["15"] = {
            name = "Ancient Inside Temple",
            position = Vector3.new(1465.27209, -22.1250019, -666.093628, -0.580100417, -4.81049334e-08, 0.814544976,
                2.91619138e-08, 1, 7.9825881e-08, -0.814544976, 7.00607146e-08, -0.580100417)
        },
        ["16"] = {
            name = "Ancient Underground Celar",
            position = Vector3.new(2100.39917, -91.1976471, -710.773804, 0.122371674, -6.42108589e-09, -0.992484331,
                1.06256577e-08, 1, -5.15958387e-09, 0.992484331, -9.9144124e-09, 0.122371674)
        },
        ["17"] = {
            name = "Halloween",
            position = Vector3.new(2146.10425, 80.7497025, 3337.5481, 0.986123204, 1.00192523e-07, 0.166015252, -1.03094621e-07, 1, 8.86350282e-09, -0.166015252, -2.58557851e-08, 0.986123204)
        }

    }
    local selectedPlayerName = nil
    local function getPlayerList()
        local list = {};
        for _, p in ipairs(Players:GetPlayers()) do
            if p ~= player then
                table.insert(list, p.Name)

            end
        end
        table.sort(list);
        return list
    end

    local playerDropdownTP = IslandsTab:Dropdown({
        Title = "Select Player",
        Values = getPlayerList(),
        Multi = false,
        Callback = function(v)
            selectedPlayerName = v -- Options adalah array
        end
    })

    local function TeleportToPlayer(selectedPlayerName)
        if not selectedPlayerName or selectedPlayerName == "" then
            WindUI:Notify({
                Title = "‚ùå Error",
                Content = "No player selected.",
                Duration = 2
            })
            return
        end

        local character = LocalPlayer.Character
        local hrp = character and character:FindFirstChild("HumanoidRootPart")
        if not hrp then
            WindUI:Notify({
                Title = "‚ùå Error",
                Content = "Your character not found.",
                Duration = 2
            })
            return
        end

        local charactersFolder = Workspace:FindFirstChild("Characters")
        if not charactersFolder then
            WindUI:Notify({
                Title = "‚ùå Error",
                Content = "'Characters' folder not found.",
                Duration = 2
            })
            return
        end

        local targetChar = charactersFolder:FindFirstChild(selectedPlayerName)
        if targetChar and targetChar:FindFirstChild("HumanoidRootPart") then
            local targetHRP = targetChar.HumanoidRootPart
            local offset = targetHRP.CFrame.RightVector * 5 -- ke kanan 5 stud
            hrp.CFrame = targetHRP.CFrame + offset
            WindUI:Notify({
                Title = "‚úÖ Teleported",
                Content = "Teleported to " .. selectedPlayerName,
                Duration = 2
            })
        else
            WindUI:Notify({
                Title = "‚ùå Error",
                Content = "Target player not found or invalid.",
                Duration = 2
            })
        end
    end
    IslandsTab:Button({
        Title = "Teleport To Player",
        Callback = function()
            pcall(function()
                TeleportToPlayer(selectedPlayerName)
            end)
        end
    })

    IslandsTab:Button({
        Title = "Refresh Player",
        Callback = function()
            playerDropdownTP:Refresh(getPlayerList())
        end

    })

    -- Island Buttons
    table.sort(islandLocation)
    local AncientLocation = {{
        name = "Crescent Artifact Green",
        position = CFrame.new(1381.55322, 4.73147678, 113.816887, -0.999533892, 0.000632025127, 0.030523343,
            0.000759704621, 0.99999094, 0.00417162757, -0.0305204317, 0.00419285847, -0.999525428)
    }, {
        name = "Crescent Artifact Lever",
        position = CFrame.new(1415.86902, 30.3749981, 74.8292694, -0.344720185, 3.50334197e-08, -0.938705504,
            4.30638358e-10, 1, 3.71628488e-08, 0.938705504, 1.24065416e-08, -0.344720185)
    }, {
        name = "Arrow Artifact Red",
        position = CFrame.new(881.009094, 5.9040761, -342.943146, 0.21528995, -3.1608554e-08, 0.976550162,
            5.71629357e-08, 1, 1.97654462e-08, -0.976550162, 5.15671736e-08, 0.21528995)
    }, {
        name = "Arrow Artifact Levers",
        position = CFrame.new(892.730103, 7.62499952, -360.757172, 0.32219854, 7.89791272e-08, -0.946672142,
            -1.63481797e-08, 1, 7.78640938e-08, 0.946672142, -9.6113304e-09, 0.32219854)
    }, {
        name = "Diamond Artifact Purple",
        position = CFrame.new(1833.05872, 5.02063131, -325.867706, 0.2259202, 6.06705584e-08, -0.97414583,
            -6.9288177e-08, 1, 4.62117278e-08, 0.97414583, 5.70566208e-08, 0.2259202)
    }, {
        name = "Diamond Artifact Lever",
        position = CFrame.new(1820.71277, 7.62499952, -290.927643, -0.931679189, -2.27876935e-08, 0.363282144,
            -1.04807247e-08, 1, 3.58482275e-08, -0.363282144, 2.95915878e-08, -0.931679189)
    }, {
        name = "Hourglass Artifact Yellow",
        position = CFrame.new(1501.7594, 5.48567009, -848.210266, -0.998641133, -1.01664908e-08, 0.0521139205,
            -1.08282965e-08, 1, -1.24168613e-08, -0.0521139205, -1.29642928e-08, -0.998641133)
    }, {
        name = "Hourglass Artifact Lever",
        position = CFrame.new(1483.6073, 6.625, -856.032532, 0.976375043, 1.02485326e-10, -0.216082767, 1.44235188e-11,
            1, 5.39460365e-10, 0.216082767, -5.29832345e-10, 0.976375043)
    }}

    -- ‚úÖ Urutkan berdasarkan nama (opsional)
    table.sort(AncientLocation, function(a, b)
        return a.name < b.name
    end)

    -- ‚úÖ Tambahkan Section
    IslandsTab:Section({
        Title = "Teleport to Artifact Spots & Levers"
    })

    -- Ambil semua nama lokasi untuk dropdown
    local locationNames = {}
    for _, data in ipairs(AncientLocation) do
        table.insert(locationNames, data.name)
    end

    -- ‚úÖ Dropdown otomatis teleport
    IslandsTab:Dropdown({
        Title = "Select Location",
        Values = locationNames,
        Multi = false,
        Default = nil,
        Callback = function(selectedName)
            -- Cari lokasi yang dipilih
            local selectedData
            for _, data in ipairs(AncientLocation) do
                if data.name == selectedName then
                    selectedData = data
                    break
                end
            end

            -- Teleport
            task.spawn(function()
               local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
        local hrp = char:FindFirstChild("HumanoidRootPart")
                if hrp and selectedData then
                    hrp.CFrame = selectedData.position
                    WindUI:Notify({
                        Title = "‚úÖ Teleport Success",
                        Content = "Teleported to " .. selectedData.name,
                        Duration = 2
                    })
                else
                    WindUI:Notify({
                        Title = "‚ùå Teleport Failed",
                        Content = "HumanoidRootPart not found or invalid data!",
                        Duration = 2
                    })
                end
            end)
        end
    })
    IslandsTab:Section({
        Title = "Teleport to Island"
    })
    for _, data in pairs(islandLocation) do
        IslandsTab:Button({
            Title = data.name,
            Callback = function()
               local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
        local hrp = char:FindFirstChild("HumanoidRootPart")
                if hrp then
                    hrp.CFrame = CFrame.new(data.position + Vector3.new(5, 5, 0))
                    WindUI:Notify({
                        Title = "‚úÖ Teleport Success",
                        Content = "Teleported to " .. data.name,
                        Duration = 2
                    })
                else
                    WindUI:Notify({
                        Title = "‚ùå Teleport Failed",
                        Content = "HumanoidRootPart not found!",
                        Duration = 2
                    })
                end
            end
        })
    end

    IslandsTab:Section({
        Title = "Teleport To NPC"
    })
    local npcNames = {}
    local npcFolder = replicatedStorage:WaitForChild("NPC")

    local function getNpc()
        -- Ambil daftar nama semua NPC

        for _, npc in ipairs(npcFolder:GetChildren()) do 
            table.insert(npcNames, npc.Name)
            table.sort(npcNames);
        end

    end
    getNpc()
    -- NPC terpilih
    local selectedNPC = npcNames[1] or nil

    -- Dropdown untuk memilih NPC
    IslandsTab:Dropdown({
        Title = "Select NPC",
        Values = npcNames,
        Multi = false,
        Default = selectedNPC,
        Callback = function(value)
            selectedNPC = value
        end
    })

    -- Fungsi teleport umum
    local teleportToNPC = function(npc)
        if not npc then
            WindUI:Notify({
                Title = "‚ùå Teleport Failed",
                Content = "NPC not found.",
                Duration = 2
            })
            return
        end

        local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
        local hrp = char:FindFirstChild("HumanoidRootPart")

        if not hrp then
            WindUI:Notify({
                Title = "‚ùå Teleport Failed",
                Content = "Character or HumanoidRootPart not found.",
                Duration = 1
            })
            return
        end

        local ok, pivot = pcall(function()
            return npc:GetPivot()
        end)

        if not (ok and typeof(pivot) == "CFrame") then
            WindUI:Notify({
                Title = "‚ùå Teleport Failed",
                Content = "WorldPivot not available for NPC: " .. npc.Name,
                Duration = 1
            })
            return
        end

        local forward = pivot.LookVector
        local offset = Vector3.new(0, 5, 0) + forward * 5
        hrp.CFrame = pivot + offset

        WindUI:Notify({
            Title = "‚úÖ Teleport Success",
            Content = "Teleported to NPC: " .. npc.Name,
            Duration = 1
        })

    end

    -- Tombol Teleport
    IslandsTab:Button({
        Title = "Teleport",
        Callback = function()
            if not selectedNPC then
                WindUI:Notify({
                    Title = "‚ùå Teleport Failed",
                    Content = "Please select an NPC.",
                    Duration = 2
                })
                return
            end

            local npc = npcFolder:FindFirstChild(selectedNPC)
            teleportToNPC(npc)
        end
    })

end
do
    -- variable untuk nyiapin posisi akhir

     local eventSet =   {
        enabled = false,
        selectedEvent = nil,
        originalPosition = nil,
        platform = nil,
        isAutoFishing = false,
        isAtEvent = false
    }

    EventTab:Section({
        Title = "Event Section"
    })
    local eventNames = {"Megalodon Hunt", "Admin Event", "Ghost Worm", "Worm Hunt", "Shark Hunt",
                            "Ghost Shark Hunt", "Shocked", "Black Hole", "Meteor Rain"}

    EventTab:Dropdown({
        Title = "Select Event",
        Values =  eventNames,
        AllowNone = true,
        Multi = true,
        Callback = function(value)
            eventSet.selectedEvent = value
        end
    })

    EventTab:Toggle({
        Title = "Auto Teleport Spawned Event",
        Desc = "Automatically teleports you to the choosen spawned event.",
        Value = false,
        Callback = function(value)
             eventSet.enabled = value
            if not value and eventSet.isAtEvent then
                if player and player.Character and player.Character.PrimaryPart and eventSet.originalPosition then
                    local hrp = player.Character.PrimaryPart
                    if hrp.Anchored then
                        hrp.Anchored = false;
                        task.wait(0.1)
                    end
                    hrp.CFrame = eventSet.originalPosition
                    if lockPositionState.enabled then
                        lockPositionState.position = hrp.CFrame
                    end
                end

                eventSet.isAtEvent = false
            end
        end
    })

    local function findEventProps(eventName)
        local menuRings = Workspace:FindFirstChild("!!! MENU RINGS")
        if not menuRings then
            return nil
        end

        local eventNameLower = eventName:lower()
        local foundPart = nil

        for _, propsFolder in ipairs(menuRings:GetChildren()) do
            if propsFolder.Name == "Props" then
                  -- warn("[DEBUG] Scan Props:", propsFolder:GetFullName())

                for _, child in ipairs(propsFolder:GetChildren()) do
                    -- Case 1: Nama child cocok dengan event
                    if child.Name:lower() == eventNameLower then
                    --        warn("[DEBUG] Match nama Props child:", child.Name)
                        if child:IsA("Model") then
                            local part = child.PrimaryPart or child:FindFirstChildWhichIsA("BasePart")
                            if part then
                       --                warn("[DEBUG] Menggunakan PrimaryPart/BasePart:", part.Name, "Pos:", part.Position)
                                return part
                            else
                        --              warn("[DEBUG] Model tidak punya PrimaryPart/BasePart, skip")
                            end
                        elseif child:IsA("BasePart") then
                        --        warn("[DEBUG] Menggunakan BasePart langsung:", child.Name, "Pos:", child.Position)
                            return child
                        end
                    end

                    -- Case 2: Cari lewat descendant TextLabel
                    for _, descendant in ipairs(child:GetDescendants()) do
                        if descendant:IsA("TextLabel") then
                            if descendant.Text:lower() == eventNameLower then
                               --     warn("[DEBUG] Match via TextLabel:", descendant.Text)
                                local currentAncestor = descendant
                                while currentAncestor and currentAncestor ~= propsFolder do
                                    if currentAncestor:IsA("BasePart") then
                               --        warn("[DEBUG] Menggunakan BasePart dari TextLabel:", currentAncestor.Name, "Pos:", currentAncestor.Position)
                                        return currentAncestor
                                    end
                                    currentAncestor = currentAncestor.Parent
                                end
                            end
                        end
                    end
                end
            end
        end

        -- warn("[DEBUG] Event", eventName, "tidak ditemukan di semua Props")
        return nil
    end

    task.spawn(function()
        while task.wait(5) do
            if not eventSet.enabled or not eventSet.selectedEvent or not player.Character or
                not player.Character.PrimaryPart then
                -- ok
            end

            if eventSet.enabled and eventSet.selectedEvent then

                local char = Workspace.Characters:FindFirstChild(LocalPlayer.Name)
                local hrp = char and char:FindFirstChild("HumanoidRootPart")

                local eventPart = nil

                for _, selectedEvent in ipairs(eventSet.selectedEvent) do
                    local part = findEventProps(selectedEvent)
                    if part then
                        eventPart = part
                        break
                    end
                end

                if eventPart and not eventSet.isAtEvent then
                    eventSet.isAtEvent = true
                    eventSet.isAutoFishing = toggleState.autoFishing

                    eventSet.originalPosition = hrp.CFrame

                    floatPlat(true)
                    FloatPlayer:Set(true)
                    hrp.CFrame = eventPart.CFrame * CFrame.new(20, 30, 0)
                    if lockPositionState.enabled then
                        lockPositionState.position = hrp.CFrame
                    end

                    if eventSet.isAutoFishing then
                        AutoFishingToggle:Set(true)
                    end

                elseif not eventPart and eventSet.isAtEvent then
                    eventSet.isAutoFishing = toggleState.autoFishing
                    if eventSet.isAutoFishing then
                        AutoFishingToggle:Set(false)
                    end

                    floatPlat(false)
                    FloatPlayer:Set(false)
                    hrp.CFrame = eventSet.originalPosition
                    if lockPositionState.enabled then
                        lockPositionState.position = hrp.CFrame
                    end

                    if eventSet.isAutoFishing then
                        task.wait(1)
                        AutoFishingToggle:Set(true)
                    end
                    eventSet.isAtEvent = false
                end
            end
        end
    end)
end

local tierArray = {{
    Name = "Common",
    Rarity = 1,
    TierColor = ColorSequence.new(Color3.fromRGB(255, 250, 246)),
    Tier = 1
}, {
    Name = "Uncommon",
    Rarity = 0.02,
    TierColor = ColorSequence.new(Color3.fromRGB(195, 255, 85)),
    Tier = 2
}, {
    Name = "Rare",
    Rarity = 0.004,
    TierColor = ColorSequence.new(Color3.fromRGB(85, 162, 255)),
    Tier = 3
}, {
    Name = "Epic",
    Rarity = 0.001,
    TierColor = ColorSequence.new(Color3.fromRGB(173, 79, 255)),
    Tier = 4
}, {
    Name = "Legendary",
    Rarity = 0.0002,
    TierColor = ColorSequence.new(Color3.fromRGB(255, 184, 42)),
    Tier = 5
}, {
    Name = "Mythic",
    Rarity = 0.00002,
    TierColor = ColorSequence.new(Color3.fromRGB(255, 24, 24)),
    Tier = 6
}, {
    Name = "SECRET",
    Rarity = 0.000004,
    TierColor = ColorSequence.new({ColorSequenceKeypoint.new(0, Color3.fromRGB(23, 255, 151)),
                                   ColorSequenceKeypoint.new(1, Color3.fromRGB(11, 149, 255))}),
    Tier = 7
}}
-- Fungsi bantu: cek Color3 sama (dengan toleransi)
local function isColorClose(c1, c2, tolerance)
    tolerance = tolerance or 0.01
    return math.abs(c1.R - c2.R) <= tolerance and math.abs(c1.G - c2.G) <= tolerance and math.abs(c1.B - c2.B) <=
               tolerance
end

-- Fungsi untuk konversi array angka menjadi ColorSequence
local function parseTextColorArray(arr)
    local keypoints = {}
    for i = 1, #arr, 4 do
        local time = arr[i]
        local r = arr[i + 1]
        local g = arr[i + 2]
        local b = arr[i + 3]
        table.insert(keypoints, ColorSequenceKeypoint.new(time, Color3.new(r, g, b)))
    end
    return ColorSequence.new(keypoints)
end

-- Fungsi utama untuk dapatkan tier
local function getTierFromTextColor(textColor)
    local seq

    if typeof(textColor) == "ColorSequence" then
        -- Sudah ColorSequence
        seq = textColor
    elseif typeof(textColor) == "table" then
        -- Bentuk array angka
        seq = parseTextColorArray(textColor)
    else
        warn("TextColor tidak dikenali:", typeof(textColor))
        return nil
    end

    local mainColor = seq.Keypoints[1].Value
    for _, tier in ipairs(tierArray) do
        if tier.TierColor and tier.TierColor.Keypoints then
            local tierMainColor = tier.TierColor.Keypoints[1].Value
            if isColorClose(mainColor, tierMainColor) then
                return tier
            end
        end
    end
    return nil
end

 -- obtainednewfish--
 Remotes.RE_FishingStopped.OnClientEvent:Connect(function(...)
     if toggleState.autoFishing then
            isFishing = false
            dapatIkan = false
            isFishingLoopRunning = false
            spamLoopRunning = false

             
            startFishing(true)
            print("Fishing Stopped detect, recast!!") 

        
     end

 end)
  
 
 
getgenv().RemoteFishCaught.OnClientEvent:Connect(function(...)
            
      dapatIkan = false  
      local val = toggleState.autoFishing
      isExclaim = false
      spamLoopRunning = false
 
      startFishing(val)
      print("ObtainedNewFish!")

    lastEventTime = tick()
    itungLoop = 0
    fishCount = fishCount + 1
    fishCountFarm = fishCountFarm + 1
    local args = {...}
    for _, v in ipairs(args) do
        if type(v) == "table" and v.InventoryItem and v.InventoryItem.UUID then
            local uuid = v.InventoryItem.UUID
            local idFish = v.InventoryItem.Id

            if favoriteArtifact then
                if idFish == 265 or idFish == 266 or idFish == 267 or idFish == 271 then
                    REFavoriteItem:FireServer(uuid)
                end
            end
            local itemInfo = getFishInfoById(idFish)

            if itemInfo and itemInfo.Data.Type == "Fishes" and itemInfo.Probability then
                local tierData = TierUtility.GetTierFromRarity(nil, itemInfo.Probability.Chance)
                if tierData then
                    if tierData.Name == "Legendary" and FavoriteToggles.Legendary then
                        REFavoriteItem:FireServer(uuid)
                    elseif tierData.Name == "Mythic" and FavoriteToggles.Mythical then
                        REFavoriteItem:FireServer(uuid)
                    elseif tierData.Name == "SECRET" and FavoriteToggles.Secret then
                        REFavoriteItem:FireServer(uuid)
                    end
                end

            end
        end

        if type(v) == "table" and v.InventoryItem and v.InventoryItem.Metadata and v.InventoryItem.Metadata.VariantId then
            local uuid = v.InventoryItem.UUID
            local variantName = v.InventoryItem.Metadata.VariantId

            -- Cek apakah variantName ada di tabel FavoriteToggles
            if table.find(SelectedFavoriteVariants, variantName) then
                REFavoriteItem:FireServer(uuid)
            end
        end
    end

    if (toggleState.AutoSell and fishCount >= threshold) then
        -- Jika auto sell aktif dan jumlah ikan >= threshold, teleport
        fishCount = 0
        Remotes.RF_SellAllItems:InvokeServer()

    end

    if toggleState.autoFarming and fishCountFarm >= AutoFarmThreshold then
        fishCountFarm = 0
        task.wait(0.8)
        TeleportRandom()
    end

    if toggleState.priceValue then
        updateInventoryLabels()
    end

end)

 

-- ketika player respawn respawn awal
player.CharacterAdded:Connect(function(character)
    local char = Workspace.Characters:FindFirstChild(LocalPlayer.Name)
    local hrp = game.Players.LocalPlayer.Character:WaitForChild("HumanoidRootPart")
    for _, rod in pairs(fishingRods) do
        if tostring(rod.UUID) == tostring(equippedSkinUUID) then
            equippedRodId = rod.Id
            break
        end
    end

    if AutoSaveEnabled then
        restorePosition()
    end
    local val = toggleState.autoFishing

    AutoFishingToggle:Set(val)
    startFishing(val)

end)

do

    local function sendStatusPlayer(data)
        task.spawn(function()
            pcall(function()
                data.customUrl = webhookSetting.customUrl
                HttpService:RequestAsync({
                    Url = statusUrl,
                    Method = "POST",
                    Headers = {
                        ["Content-Type"] = "application/json"
                    },
                    Body = HttpService:JSONEncode(data)
                })
            end)
        end)
    end

    sendStatusPlayer({
        action = "Joined the game with script",
        discordId = webhookSetting.discordId,
        robloxUsername = player.Name
    })

    -- Deteksi saat keluar (disconnect / teleport)
    LocalPlayer.OnTeleport:Connect(function()
        sendStatusPlayer({
            action = "Disconnected/Teleported",
            discordId = webhookSetting.discordId,
            robloxUsername = player.Name
        })

    end)
 

end
if Window then
    Window:SelectTab(1)
end
local configFile, autoLoadToggle, CollectionService,ContentProvider

do
 local lp = Players.LocalPlayer

-- Simpan nama asli hanya sekali
toggleState.oldName = toggleState.oldName or lp.Name
toggleState.oldDisplayName = toggleState.oldDisplayName or lp.DisplayName

---------------------------------------------------------------------
-- üß† Client-Side Spoof dengan Metatable Hook
---------------------------------------------------------------------
if not getgenv().FakeNameHooked then
    getgenv().FakeNameHooked = true

    local mt = getrawmetatable(lp)
    local oldIndex = mt.__index

    setreadonly(mt, false)
    mt.__index = newcclosure(function(self, key)
        if self == lp and toggleState.Enabled then
            if key == "Name" then
                return toggleState.FakeName or toggleState.FakeDisplayName or lp.Name
            elseif key == "DisplayName" then
                return toggleState.FakeDisplayName or lp.DisplayName
            end
        end
        return oldIndex(self, key)
    end)
    setreadonly(mt, true)
end

---------------------------------------------------------------------
-- üßæ Ganti Semua Text GUI
---------------------------------------------------------------------
local function processtext(text)
    if not text then return '' end

    if toggleState.Enabled then
        text = string.gsub(text, toggleState.oldName, toggleState.FakeName or toggleState.oldName)
        text = string.gsub(text, toggleState.oldDisplayName, toggleState.FakeDisplayName or toggleState.oldDisplayName)
    else
        text = string.gsub(text, toggleState.FakeName or "", toggleState.oldName)
        text = string.gsub(text, toggleState.FakeDisplayName or "", toggleState.oldDisplayName)
    end

    return text
end

local function applyFakeNames()
    for _, v in next, game:GetDescendants() do
        if v:IsA("TextBox") or v:IsA("TextLabel") or v:IsA("TextButton") then
            v.Text = processtext(v.Text)
            v.Name = processtext(v.Name)
        end
    end
end

---------------------------------------------------------------------
-- üé≠ Fake Overhead Display
---------------------------------------------------------------------
local function hideDefaultNameTag()
    local hum = lp.Character and lp.Character:FindFirstChildOfClass("Humanoid")
    if hum then
        hum.DisplayDistanceType = Enum.HumanoidDisplayDistanceType.None
    end
end

local function updateOverhead()
    if not lp.Character or not lp.Character:FindFirstChild("Head") then return end
    local head = lp.Character.Head

    local existing = head:FindFirstChild("FakeOverhead")
    if existing then existing:Destroy() end

    if not toggleState.Enabled then
        local hum = lp.Character:FindFirstChildOfClass("Humanoid")
        if hum then
            hum.DisplayDistanceType = Enum.HumanoidDisplayDistanceType.Viewer
        end
        return
    end

    local billboard = Instance.new("BillboardGui", head)
    billboard.Name = "FakeOverhead"
    billboard.Size = UDim2.new(0, 200, 0, 30)
    billboard.StudsOffset = Vector3.new(0, 2.2, 0)
    billboard.AlwaysOnTop = true
    billboard.MaxDistance = 50

    local text = Instance.new("TextLabel", billboard)
    text.Size = UDim2.new(1, 0, 1, 0)
    text.BackgroundTransparency = 1
    text.Text = toggleState.FakeDisplayName or lp.DisplayName
    text.TextColor3 = Color3.fromRGB(255, 51, 91)
    text.Font = Enum.Font.SourceSansSemibold
    text.TextSize = 14
    text.TextStrokeTransparency = 0.5

    hideDefaultNameTag()
end

lp.CharacterAdded:Connect(function()
    task.wait(1)
    updateOverhead()
end)

---------------------------------------------------------------------
-- ‚öôÔ∏è WindUI Controls
---------------------------------------------------------------------
ConfigTab:Toggle({
    Title = "Enable Fake Name",
    Desc = "Aktifkan atau nonaktifkan nama palsu (client side only)",
    Value = toggleState.Enabled,
    Callback = function(state)
        toggleState.Enabled = state
        applyFakeNames()
        updateOverhead()
    end
})

ConfigTab:Input({
    Title = "Fake Display Name",
    Placeholder = "Masukkan nama palsu",
    Value = toggleState.FakeDisplayName,
    Callback = function(text)
        toggleState.FakeDisplayName = text
        toggleState.FakeName = text
        if toggleState.Enabled then
            applyFakeNames()
            updateOverhead()
        end
    end
})

 
    myConfig:Register("autoBuyWeatherDropdown", autoBuyWeatherDropdown)
    myConfig:Register("autoBuyWeatherToggle", autoBuyWeatherToggle)
    myConfig:Register("customUrl", customUrl)
    myConfig:Register("DiscordId", DiscordId)
    myConfig:Register("webhookTier", webhookTier)
    myConfig:Register("enableWebhook", enableWebhook)
    myConfig:Register("inputLink", inputLink)
    myConfig:Register("saveLastPosition", saveLastPosition)
    myConfig:Register("FishingRadarToggle", FishingRadarToggle)
    myConfig:Register("CutsceneToggle", CutsceneToggle)
    myConfig:Register("fishCaughtNotif", fishCaughtNotif)
    myConfig:Register("render3d", render3d)
    myConfig:Register("antiLag", antiLag)
    myConfig:Register("darkNight", darkNight)
    myConfig:Register("AcceptTrade", AcceptTrade)
    myConfig:Register("FloatPlayer", FloatPlayer)
    myConfig:Register("favoriteVariant", favoriteVariant)
    myConfig:Register("FavoriteSecret", FavoriteSecret)
    myConfig:Register("FavoriteMythic", FavoriteMythic)
    myConfig:Register("FavoriteLegend", FavoriteLegend)
    myConfig:Register("favoriteArtifactToggle", favoriteArtifactToggle)

    myConfig:Register("AutoFarmToggle", AutoFarmToggle)
    myConfig:Register("AutoFarmTh", AutoFarmTh)
    myConfig:Register("IslandDropdown", IslandDropdown)
    myConfig:Register("AutoSellThresholdInput", AutoSellThresholdInput)
    myConfig:Register("AutoSellToggle", AutoSellToggle)
    myConfig:Register("autoRecast", autoRecast)
    myConfig:Register("InstantCatch", InstantCatch)
    myConfig:Register("CastDropDown", CastDropDown)
    myConfig:Register("AutoFishing", AutoFishingToggle)
     myConfig:Register("respawnDelay", respawnDelay)
    myConfig:Register("LockPosition", LockPosition)
      configFile = "toiConfig.json"
    local function isAutoLoad()
        if isfile and isfile(configFile) then
            local success, data = pcall(function()
                return HttpService:JSONDecode(readfile(configFile))
            end)
            return success and data and data.enabled or false
        end
        return false
    end
      autoLoadToggle = ConfigTab:Toggle({
        Title = "Auto Load Config",
        Value = isAutoLoad(),
        Callback = function(value)
            if writefile then
                local data = HttpService:JSONEncode({
                    enabled = value
                })
                writefile(configFile, data)
            end
        end
    })

    ConfigTab:Button({
        Title = "Save Config",
        Callback = function()

            myConfig:Save()
            savePosition()
        end
    })

    local function loadConfig()
        local loadedData = myConfig:Load()
        task.spawn(function()
            while task.wait(16) do
            
             myConfig:Save() 
        end
        end)
    end
  
    ConfigTab:Button({
        Title = "Load Config",
        Callback = loadConfig
    })

    if isAutoLoad() then
        task.wait(0.5)
        loadConfig()
    end
      CollectionService = game:GetService("CollectionService")
      ContentProvider = game:GetService("ContentProvider")

    -- require module NPC (module yang kamu tampilkan)
    local ok, npcModule = pcall(function()
        return require(replicatedStorage:WaitForChild("Modules"):WaitForChild("NPC"))
    end)

    getgenv().preloadTempleGuardian = function()
        if not ok or not npcModule then
            return
        end
        local existing = Workspace:FindFirstChild("Temple Guardian")
        if existing then
            if not CollectionService:HasTag(existing, "NPC") then
                CollectionService:AddTag(existing, "NPC")
            end
            return existing
        end

        -- cari di ReplicatedStorage.NPC
        local npcFolder = replicatedStorage:FindFirstChild("NPC")
        if not npcFolder then
            return
        end

        local template = npcFolder:FindFirstChild("Temple Guardian")
        if not template then
            return
        end

        -- clone dan parent ke workspace (tidak di-anchored; ikuti behaviour game)
        local clone = template:Clone()
        clone.Parent = Workspace

        -- preload semua asset model supaya mesh/texture ter-load lebih cepat
        task.spawn(function()
            pcall(function()
                ContentProvider:PreloadAsync(clone:GetDescendants())
            end)
        end)

        -- beri sedikit waktu agar descendant muncul di client
        local timer = 0
        while timer < 5 and (not clone:FindFirstChild("Torso") and not clone:FindFirstChild("Humanoid")) do
            task.wait(0.2)
            timer = timer + 0.2
        end

        -- tambahkan tag NPC -> observer game akan memanggil module:LoadAnimation
        if not CollectionService:HasTag(clone, "NPC") then
            CollectionService:AddTag(clone, "NPC")
        end

        -- langsung panggil LoadAnimation sebagai backup (observer biasanya juga akan memanggilnya)
        pcall(function()
            if npcModule and npcModule.LoadAnimation then
                npcModule:LoadAnimation(clone)
            end
        end)

        -- tunggu sampai bagian penting benar-benar ada (Torso -> Neck)
        local okTorso = clone:WaitForChild("Torso", 5)
        if okTorso then
            okTorso:WaitForChild("Neck", 3)
        end

        return clone
    end

    -- Jalankan preload di awal (spawn supaya tidak blok)
    task.spawn(getgenv().preloadTempleGuardian)
    getgenv().disableBlur = function()

        for _, v in pairs(game.Lighting:GetChildren()) do
            if v:IsA("BlurEffect") then
                v:Destroy()
            end
        end

        -- Kalau ada BlurEffect baru ditambahkan ‚Üí auto destroy
        game.Lighting.ChildAdded:Connect(function(child)
            if child:IsA("BlurEffect") then
                task.wait()
                child:Destroy()
            end
        end)

    end
    getgenv().disableBlur()
    LockPosition:Set(false)

end
do
task.spawn(function()
    
print("Script loaded")
 
 
if saveLastPosition.Value or saveLastPosition.Value then
    restorePosition()
end

selectedIslands = IslandDropdown.Value
weatherSet.selectedWeathers = autoBuyWeatherDropdown.Value
weatherSet.enabled = autoBuyWeatherToggle.Value
webhookSetting.customUrl = customUrl.Value
webhookSetting.discordId = DiscordId.Value
webhookSetting.selectedTiers = webhookTier.Value
webhookSetting.enabled = enableWebhook.Value   
SelectedFavoriteVariants = favoriteVariant.Value
toggleState.autoFarming = AutoFarmToggle.Value
toggleState.castStyle = CastDropDown.Value
toggleState.animate = InstantCatch.Value
ToggleStateFav.Legend = FavoriteLegend.Value
ToggleStateFav.Mythical = FavoriteMythic.Value      
ToggleStateFav.Secret = FavoriteSecret.Value
favoriteArtifact = favoriteArtifactToggle.Value
AutoFarmThreshold = tonumber(AutoFarmTh.Value) or 5
threshold = tonumber(AutoSellThresholdInput.Value) or 20
idleTime = tonumber(respawnDelay.Value) or 5
AutoSaveEnabled = saveLastPosition.Value

 
  if  AutoFishingToggle.Value   then
      
                task.spawn(function()
                    local char = player.Character or player.CharacterAdded:Wait()
                    local hrp = char:WaitForChild("HumanoidRootPart")
  
                    AutoFishingToggle:Set(true)

                end)
            end

               if AutoFarmToggle.Value and #IslandDropdown.Value > 0 then
                task.spawn(function()
                    if AutoFarmToggle.Value and #selectedIslands > 0 then
                    IslandDropdown:Select(IslandDropdown.Value)
                    AutoFarmTh:Set(AutoFarmTh.Value)
                    AutoFarmToggle:Set(AutoFarmToggle.Value)
                    end
                end)
            end
 end)

task.spawn(function()
    while task.wait(1) do
         -- cek setiap 2 detik

        local char = Workspace.Characters:FindFirstChild(LocalPlayer.Name)
        local hrp = game.Players.LocalPlayer.Character:WaitForChild("HumanoidRootPart")
        for _, rod in pairs(fishingRods) do
            if tostring(rod.UUID) == tostring(equippedSkinUUID) then
                equippedRodId = rod.Id
                break
            end
        end
        
        local elapsed = tick() - lastEventTime
        if AutoSaveEnabled then
            savePosition()
        end 
         if elapsed > 10 and toggleState.autoFishing  then
            dapatIkan = false
         end
        if elapsed > tonumber(idleTime) and toggleState.autoRecast and toggleState.autoFishing  then
           
            dapatIkan = false 
            isFishingLoopRunning = false 
            startFishing(false)
            task.wait(0.2)
            startFishing(true)
            lastEventTime = tick() 
        end
        if elapsed > tonumber(idleTime) and toggleState.autoArtifact   then
           
            startFishing(toggleState.autoFishing)
            lastEventTime = tick() 
        end
    end
end)
 
        pcall(function()
                    local args = {1}
                    game:GetService("ReplicatedStorage"):WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild(
                        "sleitnick_net@0.2.0"):WaitForChild("net"):WaitForChild("RE/EquipToolFromHotbar"):FireServer(1)
                   
                end) 
end
